<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute an objective function and gradient — calc_ofv_and_grad • PopED</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute an objective function and gradient — calc_ofv_and_grad"><meta property="og:description" content="Compute an objective function and gradient with respect to the optimization parameters.
This function can be passed to the Broyden Fletcher Goldfarb Shanno (BFGS) 
method for nonlinear minimization with box constraints implemented in bfgsb_min."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PopED</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro-poped.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/examples.html">Examples</a>
    </li>
    <li>
      <a href="../articles/model_def_other_pkgs.html">Defining models for PopED using R based PKPD simulators</a>
    </li>
    <li>
      <a href="../articles/handling_LOQ.html">Optimal design with LOQ data in PopED</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/andrewhooker/PopED" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
    Source
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute an objective function and gradient</h1>
    <small class="dont-index">Source: <a href="https://github.com/andrewhooker/PopED/blob/HEAD/R/Doptim.R" class="external-link"><code>R/Doptim.R</code></a></small>
    <div class="hidden name"><code>calc_ofv_and_grad.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute an objective function and gradient with respect to the optimization parameters.
This function can be passed to the Broyden Fletcher Goldfarb Shanno (BFGS) 
method for nonlinear minimization with box constraints implemented in <code><a href="bfgsb_min.html">bfgsb_min</a></code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_ofv_and_grad</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">optxt</span>,</span>
<span>  <span class="va">opta</span>,</span>
<span>  <span class="va">model_switch</span>,</span>
<span>  <span class="va">aa</span>,</span>
<span>  <span class="va">axt</span>,</span>
<span>  <span class="va">groupsize</span>,</span>
<span>  <span class="va">ni</span>,</span>
<span>  <span class="va">xtopto</span>,</span>
<span>  <span class="va">xopto</span>,</span>
<span>  <span class="va">aopto</span>,</span>
<span>  <span class="va">bpop</span>,</span>
<span>  <span class="va">d</span>,</span>
<span>  <span class="va">sigma</span>,</span>
<span>  <span class="va">docc_full</span>,</span>
<span>  <span class="va">poped.db</span>,</span>
<span>  only_fim <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A matrix for the discrete design variables.  Each row is a group.</p></dd>


<dt>optxt</dt>
<dd><p>If sampling times are optimized</p></dd>


<dt>opta</dt>
<dd><p>If continuous design variables are optimized</p></dd>


<dt>model_switch</dt>
<dd><p>A matrix that is the same size as xt, specifying which model each sample belongs to.</p></dd>


<dt>aa</dt>
<dd><p>The aa value</p></dd>


<dt>axt</dt>
<dd><p>the axt value</p></dd>


<dt>groupsize</dt>
<dd><p>A vector of the number of individuals in each group.</p></dd>


<dt>ni</dt>
<dd><p>A vector of the number of samples in each group.</p></dd>


<dt>xtopto</dt>
<dd><p>the xtopto value</p></dd>


<dt>xopto</dt>
<dd><p>the xopto value</p></dd>


<dt>aopto</dt>
<dd><p>the aopto value</p></dd>


<dt>bpop</dt>
<dd><p>Matrix defining the fixed effects, per row (row number = parameter_number) we should have:</p><ul><li><p>column 1 the type of the distribution for E-family designs (0 = Fixed, 1 = Normal, 2 = Uniform,
 3 = User Defined Distribution, 4 = lognormal and 5 = truncated normal)</p></li>
<li><p>column 2  defines the mean.</p></li>
<li><p>column 3 defines the variance of the distribution (or length of uniform distribution).</p></li>
</ul><p>Can also just supply the parameter values as a vector <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> if no uncertainty around the 
parameter value is to be used. The parameter order of  'bpop' is defined in the 'fg_fun' or 'fg_file'. If you use named 
arguments in 'bpop' then the order will be worked out automatically.</p></dd>


<dt>d</dt>
<dd><p>Matrix defining the diagonals of the IIV (same logic as for the fixed effects 
matrix bpop to define uncertainty). One can also just supply the parameter values as a <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>. 
The parameter order of 'd' is defined in the 'fg_fun' or 'fg_file'. If you use named 
arguments in 'd' then the order will be worked out automatically.</p></dd>


<dt>sigma</dt>
<dd><p>Matrix defining the variances can covariances of the residual variability terms of the model.
can also just supply the diagonal parameter values (variances) as a <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>.</p></dd>


<dt>docc_full</dt>
<dd><p>A between occasion variability matrix.</p></dd>


<dt>poped.db</dt>
<dd><p>A PopED database.</p></dd>


<dt>only_fim</dt>
<dd><p>Should the gradient be calculated?</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list containing:</p>
<dl><dt>f</dt>
<dd><p>The objective function.</p></dd>

<dt>g</dt>
<dd><p>The gradient.</p></dd>

</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other Optimize: 
<code><a href="Doptim.html">Doptim</a>()</code>,
<code><a href="LEDoptim.html">LEDoptim</a>()</code>,
<code><a href="RS_opt.html">RS_opt</a>()</code>,
<code><a href="a_line_search.html">a_line_search</a>()</code>,
<code><a href="bfgsb_min.html">bfgsb_min</a>()</code>,
<code><a href="calc_autofocus.html">calc_autofocus</a>()</code>,
<code><a href="mfea.html">mfea</a>()</code>,
<code><a href="optim_ARS.html">optim_ARS</a>()</code>,
<code><a href="optim_LS.html">optim_LS</a>()</code>,
<code><a href="poped_optim_1.html">poped_optim_1</a>()</code>,
<code><a href="poped_optim_2.html">poped_optim_2</a>()</code>,
<code><a href="poped_optim_3.html">poped_optim_3</a>()</code>,
<code><a href="poped_optimize.html">poped_optimize</a>()</code>,
<code><a href="poped_optim.html">poped_optim</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrewhooker.github.io/PopED/" class="external-link">PopED</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">############# START #################</span></span></span>
<span class="r-in"><span><span class="co">## Create PopED database</span></span></span>
<span class="r-in"><span><span class="co">## (warfarin model for optimization)</span></span></span>
<span class="r-in"><span><span class="co">#####################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Warfarin example from software comparison in:</span></span></span>
<span class="r-in"><span><span class="co">## Nyberg et al., "Methods and software tools for design evaluation </span></span></span>
<span class="r-in"><span><span class="co">##   for population pharmacokinetics-pharmacodynamics studies", </span></span></span>
<span class="r-in"><span><span class="co">##   Br. J. Clin. Pharm., 2014. </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Optimization using an additive + proportional reidual error  </span></span></span>
<span class="r-in"><span><span class="co">## to avoid sample times at very low concentrations (time 0 or very late samples).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## find the parameters that are needed to define from the structural model</span></span></span>
<span class="r-in"><span><span class="va">ff.PK.1.comp.oral.sd.CL</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (model_switch, xt, parameters, poped.db) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     with(as.list(parameters), {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         y = xt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         y = (DOSE * Favail * KA/(V * (KA - CL/V))) * (exp(-CL/V * </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             xt) - exp(-KA * xt))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(list(y = y, poped.db = poped.db))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     })</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x1205aa458&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: namespace:PopED&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## -- parameter definition function </span></span></span>
<span class="r-in"><span><span class="co">## -- names match parameters in function ff</span></span></span>
<span class="r-in"><span><span class="va">sfg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">a</span>,<span class="va">bpop</span>,<span class="va">b</span>,<span class="va">bocc</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">parameters</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               V<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               KA<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               Favail<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>               DOSE<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## -- Define initial design  and design space</span></span></span>
<span class="r-in"><span><span class="va">poped.db</span> <span class="op">&lt;-</span> <span class="fu"><a href="create.poped.database.html">create.poped.database</a></span><span class="op">(</span>ff_fun<span class="op">=</span><span class="va">ff.PK.1.comp.oral.sd.CL</span>,</span></span>
<span class="r-in"><span>                                  fg_fun<span class="op">=</span><span class="va">sfg</span>,</span></span>
<span class="r-in"><span>                                  fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span></span>
<span class="r-in"><span>                                  bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.15</span>, V<span class="op">=</span><span class="fl">8</span>, KA<span class="op">=</span><span class="fl">1.0</span>, Favail<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                                  notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.07</span>, V<span class="op">=</span><span class="fl">0.02</span>, KA<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                                  sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.01</span>,add<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  groupsize<span class="op">=</span><span class="fl">32</span>,</span></span>
<span class="r-in"><span>                                  xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">24</span>,<span class="fl">36</span>,<span class="fl">72</span>,<span class="fl">120</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  minxt<span class="op">=</span><span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>                                  maxxt<span class="op">=</span><span class="fl">120</span>,</span></span>
<span class="r-in"><span>                                  a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">70</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  mina<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  maxa<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">############# END ###################</span></span></span>
<span class="r-in"><span><span class="co">## Create PopED database</span></span></span>
<span class="r-in"><span><span class="co">## (warfarin model for optimization)</span></span></span>
<span class="r-in"><span><span class="co">#####################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">opta</span><span class="op">=</span><span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="va">aa</span><span class="op">=</span><span class="va">opta</span><span class="op">*</span><span class="va">poped.db</span><span class="op">$</span><span class="va">settings</span><span class="op">$</span><span class="va">cfaa</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">m</span>,<span class="fu"><a href="size.html">size</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">a</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aa</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.001</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">optxt</span><span class="op">=</span><span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="va">axt</span><span class="op">=</span><span class="va">optxt</span><span class="op">*</span><span class="va">poped.db</span><span class="op">$</span><span class="va">settings</span><span class="op">$</span><span class="va">cfaxt</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">m</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design_space</span><span class="op">$</span><span class="va">maxni</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">axt</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.001 0.001 0.001 0.001 0.001 0.001 0.001 0.001</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">calc_ofv_and_grad</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">xt</span>,<span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">a</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  optxt<span class="op">=</span><span class="va">optxt</span>, opta<span class="op">=</span><span class="va">opta</span>, </span></span>
<span class="r-in"><span>                  model_switch<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">model_switch</span>,</span></span>
<span class="r-in"><span>                  aa<span class="op">=</span><span class="va">aa</span>,</span></span>
<span class="r-in"><span>                  axt<span class="op">=</span><span class="va">axt</span>,</span></span>
<span class="r-in"><span>                  groupsize<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">groupsize</span>,</span></span>
<span class="r-in"><span>                  ni<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">ni</span>,</span></span>
<span class="r-in"><span>                  xtopto<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">xt</span>,</span></span>
<span class="r-in"><span>                  xopto<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">x</span>,</span></span>
<span class="r-in"><span>                  aopto<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">design</span><span class="op">$</span><span class="va">a</span>,</span></span>
<span class="r-in"><span>                  bpop<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">param.pt.val</span><span class="op">$</span><span class="va">bpop</span>,</span></span>
<span class="r-in"><span>                  d<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">param.pt.val</span><span class="op">$</span><span class="va">d</span>,</span></span>
<span class="r-in"><span>                  sigma<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">param.pt.val</span><span class="op">$</span><span class="va">sigma</span>,</span></span>
<span class="r-in"><span>                  docc_full<span class="op">=</span><span class="va">poped.db</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">param.pt.val</span><span class="op">$</span><span class="va">docc</span>,</span></span>
<span class="r-in"><span>                  <span class="va">poped.db</span>,</span></span>
<span class="r-in"><span>                  only_fim<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $f</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -55.39645</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $g</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]  0.079631184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,] -0.025697327</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,] -0.312973786</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]  0.009484130</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]  0.019485306</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,] -0.001675713</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] -0.009544063</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,] -0.001929802</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,] -0.035844547</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># BFGS search, DOSE and sample time optimization</span></span></span>
<span class="r-in"><span>  <span class="va">bfgs.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="poped_optimize.html">poped_optimize</a></span><span class="op">(</span><span class="va">poped.db</span>,opt_xt<span class="op">=</span><span class="fl">1</span>,opt_a<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                bUseRandomSearch<span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                bUseStochasticGradient <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                bUseBFGSMinimizer <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                bUseLineSearch <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://katalog.uu.se/profile/?id=N4-631" class="external-link">Andrew C. Hooker</a>, Marco Foracchia, <a href="https://katalog.uu.se/profile/?id=N9-467" class="external-link">Sebastian Ueckert</a>, <a href="https://scholar.google.se/citations?user=4CgHwr0AAAAJ&amp;hl=en" class="external-link">Joakim Nyberg</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

