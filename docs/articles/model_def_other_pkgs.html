<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Defining models for PopED using R based PKPD simulators â€¢ PopED</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Defining models for PopED using R based PKPD simulators">
<meta property="og:description" content="PopED">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PopED</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro-poped.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/examples.html">Examples</a>
    </li>
    <li>
      <a href="../articles/model_def_other_pkgs.html">Defining models for PopED using R based PKPD simulators</a>
    </li>
    <li>
      <a href="../articles/handling_LOQ.html">Optimal design with LOQ data in PopED</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andrewhooker/PopED">
    <span class="fab fa fab fa-github fa-lg"></span>
     
    Source
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model_def_other_pkgs_files/header-attrs-2.2/header-attrs.js"></script><script src="model_def_other_pkgs_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Defining models for PopED using R based PKPD simulators</h1>
                        <h4 class="author">Andrew Hooker, Ron Keizer and Vijay Ivaturi</h4>
            
            <h4 class="date">13 June, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/andrewhooker/PopED/blob/master/vignettes/model_def_other_pkgs.Rmd"><code>vignettes/model_def_other_pkgs.Rmd</code></a></small>
      <div class="hidden name"><code>model_def_other_pkgs.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This is a simple example on how to couple PopED with external R based PKPD simulation tools. Typically, these tools might be R packages that can simulate from hierarchical, ordinary differential equation (ODE) based models. In this document you will see how to couple PopED to models, defined with ODEs, implemented using:</p>
<ul>
<li>deSolve (with native R ODE models)</li>
<li>deSolve (with compliled C ODE models)</li>
<li>deSolve (with compliled C++ ODE models using Rcpp)</li>
<li>PKPDsim</li>
<li>mrgsolve</li>
<li>RxODE</li>
</ul>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PopED</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PKPDsim</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mrgsolve</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">deSolve</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rcpp</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RxODE</span>)</pre></body></html></div>
<p>For the future we will also show how to use</p>
<ul>
<li>PKPDmodels</li>
<li>dMod</li>
</ul>
</div>
<div id="the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#the-model" class="anchor"></a>The model</h1>
<p>In this example we will use a one-compartment linear absorption model</p>
<p><img src="model_def_other_pkgs_1-comp-lin-abs.png"></p>
<!-- (see Figure \@ref(fig:1-comp-lin-abs)).  -->
<!-- ```{r 1-comp-lin-abs, echo=FALSE, fig.cap="Graphical representation of a one-compartment model with linear absorption."} -->
<!-- knitr::include_graphics("model_def_other_pkgs_1-comp-lin-abs.png") -->
<!-- ``` -->
<p>This model can be described with the following set of ODEs:</p>
<p><span class="math display">\[
  \begin{split}
  \frac{dA_{0}}{dt} &amp;=  - k_{a} \cdot A_{0}\\
  \frac{dA_{1}}{dt} &amp;=-(CL/V_1)\cdot A_1 + k_{a} \cdot A_{0} \\
  f(t) &amp;= A_1/V_1
  \end{split}
  (\#eq:ode)
\]</span></p>
<p>All compartment amounts are assumed to be zero at time zero (<span class="math inline">\(\boldsymbol{A}[t=0]=0\)</span>). Inputs to the system come in tablet form and are added to the amount in <span class="math inline">\(A_{0}\)</span> according to</p>
<p><span class="math display">\[
  \text{Input}(t,D,t_D) =
  \begin{cases}
   D, &amp;\text{if} \quad t = t_D \\
   0, &amp;\text{otherwise} 
  \end{cases}
  (\#eq:input)
\]</span></p>
<p>Parameter values are defined as:</p>
<p><span class="math display">\[
  \begin{split}
    k_a &amp;= \theta_1 \cdot e^{\eta_1} \\
    CL &amp;= \theta_2 \cdot e^{\eta_2} \\
    V_1 &amp;= \theta_3 \cdot e^{\eta_3}  \\
  \end{split}
  (\#eq:par)
\]</span> where elements of the between subject variability (BSV), <span class="math inline">\(\eta_{j}\)</span>, vary accross individuals and come from normal distributions with means of zero and variances of <span class="math inline">\(\omega^2_{j}\)</span>.</p>
<p>The residual unexplained variability (RUV) model has a proportional and additive component</p>
<p><span class="math display">\[
  y = A_1/V_1 \cdot (1+\varepsilon_1) + \varepsilon_2
  (\#eq:ruv)
\]</span></p>
<p>elements of <span class="math inline">\(\boldsymbol{\varepsilon}_{j}\)</span> vary accross observations and come from normal distributions with means of zero and variances of <span class="math inline">\(\sigma^2_{j}\)</span>.</p>
Parameter values are shown in Table @ref(tab:values).<br><table class="table table table-striped">
<caption>
Model parameter values.
</caption>
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:right;">
Value
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<span class="math inline">\(k_a\)</span>
</td>
<td style="text-align:right;">
0.2500
</td>
</tr>
<tr>
<td style="text-align:left;">
CL
</td>
<td style="text-align:right;">
3.7500
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(V_1\)</span>
</td>
<td style="text-align:right;">
72.8000
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\omega^2_{k_a}\)</span>
</td>
<td style="text-align:right;">
0.0900
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\omega^2_{CL}\)</span>
</td>
<td style="text-align:right;">
0.0625
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\omega^2_{V_1}\)</span>
</td>
<td style="text-align:right;">
0.0900
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\sigma^2_{prop}\)</span>
</td>
<td style="text-align:right;">
0.0400
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\sigma^2_{add}\)</span>
</td>
<td style="text-align:right;">
0.0025
</td>
</tr>
</tbody>
</table>
</div>
<div id="model-implementation" class="section level1">
<h1 class="hasAnchor">
<a href="#model-implementation" class="anchor"></a>Model implementation</h1>
<p>Below we implement this model using a number of different methods. For the ODE solvers, if possible, we set the tuning parameters to be the same values (<code>atol</code>, <code>rtol</code>, etc.).</p>
<div id="analytic-solution" class="section level2">
<h2 class="hasAnchor">
<a href="#analytic-solution" class="anchor"></a>Analytic solution</h2>
<p>First we implement an analytic solution to the model in a function that could be used in <code>PopED</code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ff</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">model_switch</span>,<span class="no">xt</span>,<span class="no">parameters</span>,<span class="no">poped.db</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">parameters</span>),{
    <span class="no">y</span><span class="kw">=</span><span class="no">xt</span>
    <span class="no">N</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="no">xt</span>/<span class="no">TAU</span>)+<span class="fl">1</span>
    <span class="no">y</span><span class="kw">=</span>(<span class="no">DOSE</span>/<span class="no">V</span>)*(<span class="no">KA</span>/(<span class="no">KA</span> - <span class="no">CL</span>/<span class="no">V</span>)) *
      (<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">CL</span>/<span class="no">V</span> * (<span class="no">xt</span> - (<span class="no">N</span> - <span class="fl">1</span>) * <span class="no">TAU</span>)) * (<span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">N</span> * <span class="no">CL</span>/<span class="no">V</span> * <span class="no">TAU</span>))/(<span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">CL</span>/<span class="no">V</span> * <span class="no">TAU</span>)) -
         <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">KA</span> * (<span class="no">xt</span> - (<span class="no">N</span> - <span class="fl">1</span>) * <span class="no">TAU</span>)) * (<span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">N</span> * <span class="no">KA</span> * <span class="no">TAU</span>))/(<span class="fl">1</span> - <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(-<span class="no">KA</span> * <span class="no">TAU</span>)))
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="kw">y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">poped.db</span><span class="kw">=</span><span class="no">poped.db</span>))
  })
}</pre></body></html></div>
</div>
<div id="ode-solution-using-desolve" class="section level2">
<h2 class="hasAnchor">
<a href="#ode-solution-using-desolve" class="anchor"></a>ODE solution using deSolve</h2>
<p>Model using ODEs defined in deSolve</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">PK_1_comp_oral_ode</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">Time</span>, <span class="no">State</span>, <span class="no">Pars</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">State</span>, <span class="no">Pars</span>)), {
    <span class="no">dA1</span> <span class="kw">&lt;-</span> -<span class="no">KA</span>*<span class="no">A1</span>
    <span class="no">dA2</span> <span class="kw">&lt;-</span> <span class="no">KA</span>*<span class="no">A1</span> - (<span class="no">CL</span>/<span class="no">V</span>)*<span class="no">A2</span>
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">dA1</span>, <span class="no">dA2</span>)))
  })
}</pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ff_ode_desolve</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">model_switch</span>, <span class="no">xt</span>, <span class="no">parameters</span>, <span class="no">poped.db</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">parameters</span>),{
    <span class="no">A_ini</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">A1</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">A2</span><span class="kw">=</span><span class="fl">0</span>)

    <span class="co">#Set up time points for the ODE</span>
    <span class="no">times_xt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(<span class="no">xt</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">times_xt</span>) <span class="co">## add extra time for start of integration</span>
    <span class="no">dose_times</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">to</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">times_xt</span>),<span class="kw">by</span><span class="kw">=</span><span class="no">TAU</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">times</span>,<span class="no">dose_times</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">times</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">times</span>) <span class="co"># remove duplicates</span>

    <span class="no">eventdat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>),
                           <span class="kw">time</span> <span class="kw">=</span> <span class="no">dose_times</span>,
                           <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">DOSE</span>), <span class="kw">method</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"add"</span>))

    <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span>(<span class="no">A_ini</span>, <span class="no">times</span>, <span class="no">PK_1_comp_oral_ode</span>, <span class="no">parameters</span>,
               <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">eventdat</span>),
               <span class="kw">atol</span><span class="kw">=</span><span class="fl">1e-8</span>, <span class="kw">rtol</span><span class="kw">=</span><span class="fl">1e-8</span>,<span class="kw">maxsteps</span><span class="kw">=</span><span class="fl">5000</span>)

    <span class="co"># grab timepoint values</span>
    <span class="no">out</span> <span class="kw">=</span> <span class="no">out</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">times_xt</span>,<span class="no">out</span>[,<span class="st">"time"</span>]),]

    <span class="no">y</span> <span class="kw">=</span> <span class="no">out</span>[,<span class="st">"A2"</span>]/<span class="no">V</span>

    <span class="no">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">y</span>) <span class="co"># must be a column matrix </span>
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">poped.db</span><span class="kw">=</span><span class="no">poped.db</span>))
  })
}</pre></body></html></div>
</div>
<div id="ode-solution-using-desolve-and-compiled-c-code" class="section level2">
<h2 class="hasAnchor">
<a href="#ode-solution-using-desolve-and-compiled-c-code" class="anchor"></a>ODE solution using deSolve and compiled C code</h2>
<p>Model using ODEs defined in deSolve with compiled code</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/readChar.html">readChar</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"examples/one_comp_oral_CL.c"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"PopED"</span>), <span class="fl">1e5</span>))
<span class="co">#&gt; /* file tmdd_qss_one_target.c */</span>
<span class="co">#&gt; #include &lt;R.h&gt;</span>
<span class="co">#&gt; static double parms[3];</span>
<span class="co">#&gt; #define CL parms[0]</span>
<span class="co">#&gt; #define V parms[1]</span>
<span class="co">#&gt; #define KA parms[2]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; /* initializer  */</span>
<span class="co">#&gt; void initmod(void (* odeparms)(int *, double *))</span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;   int N=3;</span>
<span class="co">#&gt;   odeparms(&amp;N, parms);</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; /* Derivatives and 1 output variable */</span>
<span class="co">#&gt; void derivs (int *neq, double *t, double *y, double *ydot,</span>
<span class="co">#&gt;       double *yout, int *ip)</span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     </span>
<span class="co">#&gt;   if (ip[0] &lt;1) error("nout should be at least 1");</span>
<span class="co">#&gt;     </span>
<span class="co">#&gt;   ydot[0] = -KA*y[0];</span>
<span class="co">#&gt;   ydot[1] = KA*y[0] - CL/V*y[1];</span>
<span class="co">#&gt;   yout[0] = y[0]+y[1];</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; /* END file tmdd_qss_one_target.c */</span></pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"examples/one_comp_oral_CL.c"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"PopED"</span>),<span class="st">"./one_comp_oral_CL.c"</span>)
<span class="co">#&gt; [1] FALSE</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span>(<span class="st">"R CMD SHLIB one_comp_oral_CL.c"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/dynload.html">dyn.load</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"one_comp_oral_CL"</span>, <span class="no">.Platform</span>$<span class="no">dynlib.ext</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">""</span>))</pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">ff_ode_desolve_c</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">model_switch</span>, <span class="no">xt</span>, <span class="no">parameters</span>, <span class="no">poped.db</span>){
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">parameters</span>),{
    <span class="no">A_ini</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">A1</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">A2</span><span class="kw">=</span><span class="fl">0</span>)

    <span class="co">#Set up time points for the ODE</span>
    <span class="no">times_xt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(<span class="no">xt</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">times_xt</span>) <span class="co">## add extra time for start of integration</span>
    <span class="no">dose_times</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">to</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">times_xt</span>),<span class="kw">by</span><span class="kw">=</span><span class="no">TAU</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">times</span>,<span class="no">dose_times</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">times</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">times</span>) <span class="co"># remove duplicates</span>

    <span class="no">eventdat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>),
                           <span class="kw">time</span> <span class="kw">=</span> <span class="no">dose_times</span>,
                           <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">DOSE</span>), <span class="kw">method</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"add"</span>))

    <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span>(<span class="no">A_ini</span>, <span class="no">times</span>, <span class="kw">func</span> <span class="kw">=</span> <span class="st">"derivs"</span>,
               <span class="kw">parms</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">CL</span>,<span class="no">V</span>,<span class="no">KA</span>),
               <span class="kw">dllname</span> <span class="kw">=</span> <span class="st">"one_comp_oral_CL"</span>,
               <span class="kw">initfunc</span> <span class="kw">=</span> <span class="st">"initmod"</span>, <span class="kw">nout</span> <span class="kw">=</span> <span class="fl">1</span>,
               <span class="kw">outnames</span> <span class="kw">=</span> <span class="st">"Sum"</span>,
               <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">eventdat</span>),
               <span class="kw">atol</span><span class="kw">=</span><span class="fl">1e-8</span>, <span class="kw">rtol</span><span class="kw">=</span><span class="fl">1e-8</span>,<span class="kw">maxsteps</span><span class="kw">=</span><span class="fl">5000</span>)

    <span class="co"># grab timepoint values</span>
    <span class="no">out</span> <span class="kw">=</span> <span class="no">out</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">times_xt</span>,<span class="no">out</span>[,<span class="st">"time"</span>]),]

    <span class="no">y</span> <span class="kw">=</span> <span class="no">out</span>[, <span class="st">"A2"</span>]/<span class="no">V</span>

    <span class="no">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">y</span>) <span class="co"># must be a column matrix </span>
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">poped.db</span><span class="kw">=</span><span class="no">poped.db</span>))
  })
}</pre></body></html></div>
</div>
<div id="ode-solution-using-desolve-and-compiled-c-code-via-rcpp" class="section level2">
<h2 class="hasAnchor">
<a href="#ode-solution-using-desolve-and-compiled-c-code-via-rcpp" class="anchor"></a>ODE solution using deSolve and compiled C++ code (via Rcpp)</h2>
<p>Here we define the ODE system using inline C++ code via Rcpp</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html">cppFunction</a></span>(<span class="st">'List one_comp_oral_rcpp(double Time, NumericVector A, NumericVector Pars) {
int n = A.size();
NumericVector dA(n);

double CL = Pars[0];
double V = Pars[1];
double KA = Pars[2];

dA[0] = -KA*A[0];
dA[1] = KA*A[0] - (CL/V)*A[1];
return List::create(dA);
}'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">ff_ode_desolve_rcpp</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">model_switch</span>, <span class="no">xt</span>, <span class="no">p</span>, <span class="no">poped.db</span>){
    <span class="no">A_ini</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">A1</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">A2</span><span class="kw">=</span><span class="fl">0</span>)

    <span class="co">#Set up time points for the ODE</span>
    <span class="no">times_xt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(<span class="no">xt</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">times_xt</span>) <span class="co">## add extra time for start of integration</span>
    <span class="no">dose_times</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">to</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">times_xt</span>),<span class="kw">by</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"TAU"</span>]])
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">times</span>,<span class="no">dose_times</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="no">times</span>)
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">times</span>) <span class="co"># remove duplicates</span>

    <span class="no">eventdat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>),
                           <span class="kw">time</span> <span class="kw">=</span> <span class="no">dose_times</span>,
                           <span class="kw">value</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">p</span><span class="kw">[[</span><span class="st">"DOSE"</span>]]), <span class="kw">method</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"add"</span>))

    <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span>(<span class="no">A_ini</span>, <span class="no">times</span>,
               <span class="no">one_comp_oral_rcpp</span>,
               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">CL</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"CL"</span>]],<span class="kw">V</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"V"</span>]], <span class="kw">KA</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"KA"</span>]]),
               <span class="kw">events</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">eventdat</span>),
               <span class="kw">atol</span><span class="kw">=</span><span class="fl">1e-8</span>, <span class="kw">rtol</span><span class="kw">=</span><span class="fl">1e-8</span>,<span class="kw">maxsteps</span><span class="kw">=</span><span class="fl">5000</span>)


    <span class="co"># grab timepoint values for central comp</span>
    <span class="no">y</span> <span class="kw">=</span> <span class="no">out</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">times_xt</span>,<span class="no">out</span>[,<span class="st">"time"</span>]),<span class="st">"A2"</span>,<span class="kw">drop</span><span class="kw">=</span><span class="no">F</span>]/<span class="no">p</span><span class="kw">[[</span><span class="st">"V"</span>]]

    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">poped.db</span><span class="kw">=</span><span class="no">poped.db</span>))
}</pre></body></html></div>
</div>
<div id="ode-solution-using-pkpdsim" class="section level2">
<h2 class="hasAnchor">
<a href="#ode-solution-using-pkpdsim" class="anchor"></a>ODE solution using PKPDsim</h2>
<p>The same model written as a set of ODEs using PKPDsim:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">pk1cmtoral</span> <span class="kw">&lt;-</span> <span class="kw pkg">PKPDsim</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/PKPDsim/man/new_ode_model.html">new_ode_model</a></span>(<span class="st">"pk_1cmt_oral"</span>) <span class="co"># take from library</span>
<span class="no">ff_ode_pkpdsim</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">model_switch</span>, <span class="no">xt</span>, <span class="no">p</span>, <span class="no">poped.db</span>){
    <span class="co">#Set up time points for the ODE</span>
    <span class="no">times_xt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(<span class="no">xt</span>)
    <span class="no">dose_times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">to</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">times_xt</span>),<span class="kw">by</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"TAU"</span>]])
    <span class="no">times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">times_xt</span>,<span class="no">dose_times</span>)))

    <span class="no">N</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">dose_times</span>)
    <span class="no">regimen</span> <span class="kw">=</span> <span class="kw pkg">PKPDsim</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/PKPDsim/man/new_regimen.html">new_regimen</a></span>(<span class="kw">amt</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"DOSE"</span>]],<span class="kw">n</span><span class="kw">=</span><span class="no">N</span>,<span class="kw">interval</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"TAU"</span>]])
    <span class="no">design</span> <span class="kw">&lt;-</span> <span class="kw pkg">PKPDsim</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/PKPDsim/man/sim.html">sim</a></span>(
      <span class="kw">ode</span> <span class="kw">=</span> <span class="no">pk1cmtoral</span>,
      <span class="kw">parameters</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">CL</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"CL"</span>]],<span class="kw">V</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"V"</span>]],<span class="kw">KA</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"KA"</span>]]),
      <span class="kw">regimen</span> <span class="kw">=</span> <span class="no">regimen</span>,
      <span class="kw">only_obs</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
      <span class="kw">t_obs</span> <span class="kw">=</span> <span class="no">times</span>,
      <span class="kw">checks</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
      <span class="kw">return_design</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
    <span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="kw pkg">PKPDsim</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/PKPDsim/man/sim_core.html">sim_core</a></span>(<span class="kw">sim_object</span> <span class="kw">=</span> <span class="no">design</span>, <span class="kw">ode</span> <span class="kw">=</span> <span class="no">pk1cmtoral</span>)
    <span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">tmp</span>$<span class="no">y</span>
    <span class="no">m_tmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">times_xt</span>,<span class="kw">digits</span> <span class="kw">=</span> <span class="fl">6</span>),<span class="no">tmp</span>[,<span class="st">"t"</span>])
    <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">m_tmp</span>))){
      <span class="fu"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="st">"can't find time points in solution\n"</span>,
           <span class="st">"try changing the digits argument in the match function"</span>)
    }

    <span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">y</span>[<span class="no">m_tmp</span>]
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">poped.db</span> <span class="kw">=</span> <span class="no">poped.db</span>))
}</pre></body></html></div>
</div>
<div id="ode-solution-using-mrgsolve" class="section level2">
<h2 class="hasAnchor">
<a href="#ode-solution-using-mrgsolve" class="anchor"></a>ODE solution using mrgsolve</h2>
<p>The same model written as a set of ODEs using mrgsolve:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">code</span> <span class="kw">&lt;-</span> <span class="st">'
$PARAM CL=3.75, V=72.8, KA=0.25
$CMT DEPOT CENT
$ODE
dxdt_DEPOT = -KA*DEPOT;
dxdt_CENT = KA*DEPOT - (CL/V)*CENT;
$TABLE double CP  = CENT/V;
$CAPTURE CP
'</span></pre></body></html></div>
<p>Compile and load the model with <code>mcode</code></p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">moda</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/mcode.html">mcode</a></span>(<span class="st">"optim"</span>, <span class="no">code</span>, <span class="kw">atol</span><span class="kw">=</span><span class="fl">1e-8</span>, <span class="kw">rtol</span><span class="kw">=</span><span class="fl">1e-8</span>,<span class="kw">maxsteps</span><span class="kw">=</span><span class="fl">5000</span>)
<span class="co">#&gt; Building optim ... done.</span></pre></body></html></div>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">ff_ode_mrg</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">model_switch</span>, <span class="no">xt</span>, <span class="no">p</span>, <span class="no">poped.db</span>){
  <span class="no">times_xt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(<span class="no">xt</span>)
  <span class="no">dose_times</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">to</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">times_xt</span>),<span class="kw">by</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"TAU"</span>]])
  <span class="no">time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="no">times_xt</span>,<span class="no">dose_times</span>)))
  <span class="no">is.dose</span> <span class="kw">&lt;-</span> <span class="no">time</span> <span class="kw">%in%</span> <span class="no">dose_times</span>

  <span class="no">data</span> <span class="kw">&lt;-</span>
    <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="kw">ID</span> <span class="kw">=</span> <span class="fl">1</span>,
                      <span class="kw">time</span> <span class="kw">=</span> <span class="no">time</span>,
                      <span class="kw">amt</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">is.dose</span>,<span class="no">p</span><span class="kw">[[</span><span class="st">"DOSE"</span>]], <span class="fl">0</span>),
                      <span class="kw">cmt</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">is.dose</span>, <span class="fl">1</span>, <span class="fl">0</span>),
                      <span class="kw">evid</span> <span class="kw">=</span> <span class="no">cmt</span>,
                      <span class="kw">CL</span> <span class="kw">=</span> <span class="no">p</span><span class="kw">[[</span><span class="st">"CL"</span>]], <span class="kw">V</span> <span class="kw">=</span> <span class="no">p</span><span class="kw">[[</span><span class="st">"V"</span>]], <span class="kw">KA</span> <span class="kw">=</span> <span class="no">p</span><span class="kw">[[</span><span class="st">"KA"</span>]])

  <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/mrgsim_q.html">mrgsim_q</a></span>(<span class="no">moda</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">data</span>)

  <span class="no">y</span> <span class="kw">&lt;-</span>  <span class="no">out</span>$<span class="no">CP</span>

  <span class="no">y</span> <span class="kw">&lt;-</span> <span class="no">y</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">times_xt</span>,<span class="no">out</span>$<span class="no">time</span>)]

  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="no">y</span>,<span class="kw">ncol</span><span class="kw">=</span><span class="fl">1</span>),<span class="kw">poped.db</span><span class="kw">=</span><span class="no">poped.db</span>))

}</pre></body></html></div>
</div>
<div id="ode-solution-using-rxode" class="section level2">
<h2 class="hasAnchor">
<a href="#ode-solution-using-rxode" class="anchor"></a>ODE solution using RxODE</h2>
<p>The model written for RxODE:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">modrx</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://nlmixrdevelopment.github.io/RxODE/reference/RxODE.html">RxODE</a></span>({
  <span class="no">d</span>/<span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">dt</a></span>(<span class="no">DEPOT</span>) <span class="kw">=</span> -<span class="no">KA</span>*<span class="no">DEPOT</span>;
  <span class="no">d</span>/<span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">dt</a></span>(<span class="no">CENT</span>) <span class="kw">=</span> <span class="no">KA</span>*<span class="no">DEPOT</span> - (<span class="no">CL</span>/<span class="no">V</span>)*<span class="no">CENT</span>;
  <span class="no">CP</span><span class="kw">=</span><span class="no">CENT</span>/<span class="no">V</span>;
})</pre></body></html></div>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">ff_ode_rx</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">model_switch</span>, <span class="no">xt</span>, <span class="no">p</span>, <span class="no">poped.db</span>){
  <span class="no">times_xt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(<span class="no">xt</span>)
  <span class="fu"><a href="https://nlmixrdevelopment.github.io/RxODE/reference/et.html">et</a></span>(<span class="fl">0</span>,<span class="kw">amt</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"DOSE"</span>]], <span class="kw">ii</span><span class="kw">=</span><span class="no">p</span><span class="kw">[[</span><span class="st">"TAU"</span>]], <span class="kw">until</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">times_xt</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://nlmixrdevelopment.github.io/RxODE/reference/et.html">et</a></span>(<span class="no">times_xt</span>) <span class="kw">-&gt;</span> <span class="no">data</span>

  <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://nlmixrdevelopment.github.io/RxODE/reference/rxSolve.html">rxSolve</a></span>(<span class="no">modrx</span>, <span class="no">p</span>, <span class="no">data</span>, <span class="kw">atol</span><span class="kw">=</span><span class="fl">1e-8</span>, <span class="kw">rtol</span><span class="kw">=</span><span class="fl">1e-8</span>,<span class="kw">maxsteps</span><span class="kw">=</span><span class="fl">5000</span>,
                 <span class="kw">returnType</span><span class="kw">=</span><span class="st">"data.frame"</span>)

  <span class="no">y</span> <span class="kw">&lt;-</span>  <span class="no">out</span>$<span class="no">CP</span>[<span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span>(<span class="no">times_xt</span>,<span class="no">out</span>$<span class="no">time</span>)]

  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="no">y</span>,<span class="kw">ncol</span><span class="kw">=</span><span class="fl">1</span>),<span class="kw">poped.db</span><span class="kw">=</span><span class="no">poped.db</span>))

}</pre></body></html></div>
</div>
<div id="common-model-elements" class="section level2">
<h2 class="hasAnchor">
<a href="#common-model-elements" class="anchor"></a>Common model elements</h2>
<p>Other functions are used to define BSV and RUV.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r">
<span class="no">sfg</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>,<span class="no">a</span>,<span class="no">bpop</span>,<span class="no">b</span>,<span class="no">bocc</span>){
  <span class="no">parameters</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="kw">KA</span><span class="kw">=</span><span class="no">bpop</span>[<span class="fl">1</span>]*<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">b</span>[<span class="fl">1</span>]),
    <span class="kw">CL</span><span class="kw">=</span><span class="no">bpop</span>[<span class="fl">2</span>]*<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">b</span>[<span class="fl">2</span>]),
    <span class="kw">V</span><span class="kw">=</span><span class="no">bpop</span>[<span class="fl">3</span>]*<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">b</span>[<span class="fl">3</span>]),
    <span class="kw">DOSE</span><span class="kw">=</span><span class="no">a</span>[<span class="fl">1</span>],
    <span class="kw">TAU</span><span class="kw">=</span><span class="no">a</span>[<span class="fl">2</span>])
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>( <span class="no">parameters</span> )
}

<span class="no">feps</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">model_switch</span>,<span class="no">xt</span>,<span class="no">parameters</span>,<span class="no">epsi</span>,<span class="no">poped.db</span>){
  <span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">poped.db</span>$<span class="no">model</span>$<span class="no">ff_pointer</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">model_switch</span>,<span class="no">xt</span>,<span class="no">parameters</span>,<span class="no">poped.db</span>))<span class="kw">[[</span><span class="fl">1</span>]]
  <span class="no">y</span> <span class="kw">=</span> <span class="no">y</span>*(<span class="fl">1</span>+<span class="no">epsi</span>[,<span class="fl">1</span>])+<span class="no">epsi</span>[,<span class="fl">2</span>]
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">poped.db</span><span class="kw">=</span><span class="no">poped.db</span>))
}</pre></body></html></div>
</div>
</div>
<div id="create-poped-databases" class="section level1">
<h1 class="hasAnchor">
<a href="#create-poped-databases" class="anchor"></a>Create PopED databases</h1>
<p>Next we define the model to use, the parameters of those models, the intial design design and design space for any design calculation. Here we create a number of databases that correspond to different model implementations.</p>
<p>The initial design is a 2 group design, with doses of 20 mg or 40 mg every 24 hours. Each group has the same sampling schedule, with 3 samples in the first day of the study and 2 on the 10th day of the study.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">poped_db_analytic</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="kw">ff_fun</span> <span class="kw">=</span><span class="no">ff</span>,
                                  <span class="kw">fg_fun</span> <span class="kw">=</span><span class="no">sfg</span>,
                                  <span class="kw">fError_fun</span><span class="kw">=</span><span class="no">feps</span>,
                                  <span class="kw">bpop</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">KA</span><span class="kw">=</span><span class="fl">0.25</span>,<span class="kw">CL</span><span class="kw">=</span><span class="fl">3.75</span>,<span class="kw">V</span><span class="kw">=</span><span class="fl">72.8</span>),
                                  <span class="kw">d</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">KA</span><span class="kw">=</span><span class="fl">0.09</span>,<span class="kw">CL</span><span class="kw">=</span><span class="fl">0.25</span>^<span class="fl">2</span>,<span class="kw">V</span><span class="kw">=</span><span class="fl">0.09</span>),
                                  <span class="kw">sigma</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">prop</span><span class="kw">=</span><span class="fl">0.04</span>,<span class="kw">add</span><span class="kw">=</span><span class="fl">0.0025</span>),
                                  <span class="kw">m</span><span class="kw">=</span><span class="fl">2</span>,
                                  <span class="kw">groupsize</span><span class="kw">=</span><span class="fl">20</span>,
                                  <span class="kw">xt</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">8</span>,<span class="fl">240</span>,<span class="fl">245</span>),
                                  <span class="kw">minxt</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">240</span>,<span class="fl">240</span>),
                                  <span class="kw">maxxt</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">248</span>,<span class="fl">248</span>),
                                  <span class="kw">bUseGrouped_xt</span><span class="kw">=</span><span class="fl">1</span>,
                                  <span class="kw">a</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">DOSE</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20</span>,<span class="fl">40</span>),<span class="kw">TAU</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">24</span>,<span class="fl">24</span>)),
                                  <span class="kw">maxa</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">DOSE</span><span class="kw">=</span><span class="fl">200</span>,<span class="kw">TAU</span><span class="kw">=</span><span class="fl">24</span>),
                                  <span class="kw">mina</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">DOSE</span><span class="kw">=</span><span class="fl">0</span>,<span class="kw">TAU</span><span class="kw">=</span><span class="fl">24</span>))


<span class="no">poped_db_ode_desolve</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="no">poped_db_analytic</span>,<span class="kw">ff_fun</span> <span class="kw">=</span> <span class="no">ff_ode_desolve</span>)
<span class="no">poped_db_ode_desolve_c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="no">poped_db_analytic</span>,<span class="kw">ff_fun</span> <span class="kw">=</span> <span class="no">ff_ode_desolve_c</span>)
<span class="no">poped_db_ode_desolve_rcpp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="no">poped_db_analytic</span>,<span class="kw">ff_fun</span> <span class="kw">=</span> <span class="no">ff_ode_desolve_rcpp</span>)
<span class="no">poped_db_ode_pkpdsim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="no">poped_db_analytic</span>,<span class="kw">ff_fun</span> <span class="kw">=</span> <span class="no">ff_ode_pkpdsim</span>)
<span class="no">poped_db_ode_mrg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="no">poped_db_analytic</span>,<span class="kw">ff_fun</span> <span class="kw">=</span> <span class="no">ff_ode_mrg</span>)
<span class="no">poped_db_ode_rx</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="no">poped_db_analytic</span>,<span class="kw">ff_fun</span> <span class="kw">=</span> <span class="no">ff_ode_rx</span>)</pre></body></html></div>
</div>
<div id="model-predictions" class="section level1">
<h1 class="hasAnchor">
<a href="#model-predictions" class="anchor"></a>Model predictions</h1>
<p>So are there difference in the model predictions between the different implementations?</p>
<p>Here is a visual representation of the model predictions for this study design, based on the analytic solution:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(<span class="no">poped_db_analytic</span>,<span class="kw">model_num_points</span> <span class="kw">=</span> <span class="fl">500</span>,<span class="kw">PI</span><span class="kw">=</span><span class="no">T</span>,<span class="kw">separate.groups</span> <span class="kw">=</span> <span class="no">T</span>)</pre></body></html></div>
<p><img src="model_def_other_pkgs_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>We can compare the different predictions in this plot accross model implementations. Here we see that the accuracy of the different methods are within machine precision (or very small).</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">pred_std</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span>(<span class="no">poped_db_analytic</span>,<span class="kw">model_num_points</span> <span class="kw">=</span> <span class="fl">500</span>,<span class="kw">include_sample_times</span> <span class="kw">=</span> <span class="fl">TRUE</span>,<span class="kw">PI</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="no">pred_ode_desolve</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span>(<span class="no">poped_db_ode_desolve</span>,
                                     <span class="kw">model_num_points</span> <span class="kw">=</span> <span class="fl">500</span>,
                                     <span class="kw">include_sample_times</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                     <span class="kw">PI</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">pred_std</span>,<span class="no">pred_ode_desolve</span>)
<span class="co">#&gt; [1] TRUE</span>

<span class="no">pred_ode_desolve_c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span>(<span class="no">poped_db_ode_desolve_c</span>,
                                       <span class="kw">model_num_points</span> <span class="kw">=</span> <span class="fl">500</span>,
                                       <span class="kw">include_sample_times</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                       <span class="kw">PI</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">pred_std</span>,<span class="no">pred_ode_desolve_c</span>)
<span class="co">#&gt; [1] TRUE</span>

<span class="no">pred_ode_desolve_rcpp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span>(<span class="no">poped_db_ode_desolve_rcpp</span>,
                                          <span class="kw">model_num_points</span> <span class="kw">=</span> <span class="fl">500</span>,
                                          <span class="kw">include_sample_times</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                          <span class="kw">PI</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">pred_std</span>,<span class="no">pred_ode_desolve_rcpp</span>)
<span class="co">#&gt; [1] TRUE</span>

<span class="no">pred_ode_pkpdsim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span>(<span class="no">poped_db_ode_pkpdsim</span>,
                                     <span class="kw">model_num_points</span> <span class="kw">=</span> <span class="fl">500</span>,
                                     <span class="kw">include_sample_times</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                     <span class="kw">PI</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">pred_std</span>,<span class="no">pred_ode_pkpdsim</span>)
<span class="co">#&gt; [1] "Component \"PI_l\": Mean relative difference: 3.593837e-08"</span>

<span class="no">pred_ode_mrg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span>(<span class="no">poped_db_ode_mrg</span>,
                                 <span class="kw">model_num_points</span> <span class="kw">=</span> <span class="fl">500</span>,
                                 <span class="kw">include_sample_times</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                 <span class="kw">PI</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">pred_std</span>,<span class="no">pred_ode_mrg</span>)
<span class="co">#&gt; [1] TRUE</span>

<span class="no">pred_ode_rx</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span>(<span class="no">poped_db_ode_rx</span>,
                                 <span class="kw">model_num_points</span> <span class="kw">=</span> <span class="fl">500</span>,
                                 <span class="kw">include_sample_times</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                 <span class="kw">PI</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">pred_std</span>,<span class="no">pred_ode_rx</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
</div>
<div id="evaluate-the-design" class="section level1">
<h1 class="hasAnchor">
<a href="#evaluate-the-design" class="anchor"></a>Evaluate the design</h1>
<p>Here we compare the computation of the Fisher Information Matrix (FIM). By comparing the <span class="math inline">\(ln(det(FIM))\)</span> (the lnD-objective function value, or ofv).</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r">(<span class="no">eval_std</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_analytic</span>))
<span class="co">#&gt; $ofv</span>
<span class="co">#&gt; [1] 48.98804</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $fim</span>
<span class="co">#&gt;                   KA           CL           V       d_KA        d_CL        d_V</span>
<span class="co">#&gt; KA       1695.742314 -11.73537527 -6.75450789    0.00000     0.00000    0.00000</span>
<span class="co">#&gt; CL        -11.735375  29.99735715 -0.03288331    0.00000     0.00000    0.00000</span>
<span class="co">#&gt; V          -6.754508  -0.03288331  0.04213359    0.00000     0.00000    0.00000</span>
<span class="co">#&gt; d_KA        0.000000   0.00000000  0.00000000  147.24270     1.52226  192.23403</span>
<span class="co">#&gt; d_CL        0.000000   0.00000000  0.00000000    1.52226  2254.55188    1.21987</span>
<span class="co">#&gt; d_V         0.000000   0.00000000  0.00000000  192.23403     1.21987  634.42055</span>
<span class="co">#&gt; sig_prop    0.000000   0.00000000  0.00000000  148.86724   844.57325  387.53816</span>
<span class="co">#&gt; sig_add     0.000000   0.00000000  0.00000000 6555.68433 14391.88132 8669.58391</span>
<span class="co">#&gt;             sig_prop     sig_add</span>
<span class="co">#&gt; KA            0.0000       0.000</span>
<span class="co">#&gt; CL            0.0000       0.000</span>
<span class="co">#&gt; V             0.0000       0.000</span>
<span class="co">#&gt; d_KA        148.8672    6555.684</span>
<span class="co">#&gt; d_CL        844.5733   14391.881</span>
<span class="co">#&gt; d_V         387.5382    8669.584</span>
<span class="co">#&gt; sig_prop   7759.5374  110702.705</span>
<span class="co">#&gt; sig_add  110702.7045 4436323.946</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $rse</span>
<span class="co">#&gt;         KA         CL          V       d_KA       d_CL        d_V   sig_prop </span>
<span class="co">#&gt;  16.285678   4.909749  11.209270 120.825798  34.448477  57.300408  36.104027 </span>
<span class="co">#&gt;    sig_add </span>
<span class="co">#&gt;  24.339781</span></pre></body></html></div>
<p>All the computations give very similar results:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">eval_ode_desolve</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_desolve</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">eval_std</span>$<span class="no">ofv</span>,<span class="no">eval_ode_desolve</span>$<span class="no">ofv</span>)
<span class="co">#&gt; [1] "Mean relative difference: 2.493735e-08"</span>

<span class="no">eval_ode_desolve_c</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_desolve_c</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">eval_std</span>$<span class="no">ofv</span>,<span class="no">eval_ode_desolve_c</span>$<span class="no">ofv</span>)
<span class="co">#&gt; [1] "Mean relative difference: 2.493735e-08"</span>

<span class="no">eval_ode_desolve_rccp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_desolve_rcpp</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">eval_std</span>$<span class="no">ofv</span>,<span class="no">eval_ode_desolve_rccp</span>$<span class="no">ofv</span>)
<span class="co">#&gt; [1] "Mean relative difference: 2.493735e-08"</span>

<span class="no">eval_ode_pkpdsim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_pkpdsim</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">eval_std</span>$<span class="no">ofv</span>,<span class="no">eval_ode_pkpdsim</span>$<span class="no">ofv</span>)
<span class="co">#&gt; [1] TRUE</span>

<span class="no">eval_ode_mrg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_mrg</span>)
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">eval_std</span>$<span class="no">ofv</span>,<span class="no">eval_ode_mrg</span>$<span class="no">ofv</span>)
<span class="co">#&gt; [1] "Mean relative difference: 2.361616e-08"</span></pre></body></html></div>
</div>
<div id="speed-of-fim-computation" class="section level1">
<h1 class="hasAnchor">
<a href="#speed-of-fim-computation" class="anchor"></a>Speed of FIM computation</h1>
<p>We can compare the speed of the computations. Analytic solutions are fast, as expected, in this case more than 20 times faster than any of the ODE methods. mrgsolve is the fastest of the ODE solvers in this example. Note that, in previous work (<a href="http://pkpdsim.ronkeizer.com/speed.html" class="uri">http://pkpdsim.ronkeizer.com/speed.html</a>), much of the speed difference between mrgsolve, RxODE and PKPDsim has been found to be due to the overhead from pre- and post-processing of the simulation from ODE systems. Other ways of handling the pre- and post-processing may speed up these computations.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">microbenchmark</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="no">compare</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span>(
  <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_analytic</span>),
  <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_desolve</span>),
  <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_desolve_c</span>),
  <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_desolve_rcpp</span>),
  <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_pkpdsim</span>),
  <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_mrg</span>),
  <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="no">poped_db_ode_rx</span>),
  <span class="kw">times</span> <span class="kw">=</span> <span class="fl">100L</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span>(<span class="no">compare</span>)</pre></body></html></div>
<p><img src="model_def_other_pkgs_compare_speed.png"></p>
</div>
<div id="version-information" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#version-information" class="anchor"></a>Version information</h1>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/reexports.html">session_info</a></span>()
<span class="co">#&gt; â”€ Session info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="co">#&gt;  setting  value                       </span>
<span class="co">#&gt;  version  R version 4.0.1 (2020-06-06)</span>
<span class="co">#&gt;  os       macOS Catalina 10.15.5      </span>
<span class="co">#&gt;  system   x86_64, darwin17.0          </span>
<span class="co">#&gt;  ui       X11                         </span>
<span class="co">#&gt;  language (EN)                        </span>
<span class="co">#&gt;  collate  en_US.UTF-8                 </span>
<span class="co">#&gt;  ctype    en_US.UTF-8                 </span>
<span class="co">#&gt;  tz       Europe/Stockholm            </span>
<span class="co">#&gt;  date     2020-06-13                  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; â”€ Packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="co">#&gt;  ! package       * version     date       lib</span>
<span class="co">#&gt;    assertthat      0.2.1       2019-03-21 [2]</span>
<span class="co">#&gt;    backports       1.1.7       2020-05-13 [2]</span>
<span class="co">#&gt;    bookdown        0.19        2020-05-15 [2]</span>
<span class="co">#&gt;    boot            1.3-25      2020-04-26 [2]</span>
<span class="co">#&gt;    callr           3.4.3       2020-03-28 [2]</span>
<span class="co">#&gt;    cli             2.0.2       2020-02-28 [2]</span>
<span class="co">#&gt;    codetools       0.2-16      2018-12-24 [2]</span>
<span class="co">#&gt;    colorspace      1.4-1       2019-03-18 [2]</span>
<span class="co">#&gt;    crayon          1.3.4       2017-09-16 [2]</span>
<span class="co">#&gt;    curl            4.3         2019-12-02 [2]</span>
<span class="co">#&gt;    data.table      1.12.8      2019-12-09 [2]</span>
<span class="co">#&gt;    desc            1.2.0       2018-05-01 [2]</span>
<span class="co">#&gt;    deSolve       * 1.28        2020-03-08 [2]</span>
<span class="co">#&gt;    devtools        2.3.0       2020-04-10 [2]</span>
<span class="co">#&gt;    digest          0.6.25      2020-02-23 [2]</span>
<span class="co">#&gt;    dplyr           1.0.0       2020-05-29 [2]</span>
<span class="co">#&gt;    ellipsis        0.3.1       2020-05-15 [2]</span>
<span class="co">#&gt;    evaluate        0.14        2019-05-28 [2]</span>
<span class="co">#&gt;    fansi           0.4.1       2020-01-08 [2]</span>
<span class="co">#&gt;    fs              1.4.1       2020-04-04 [2]</span>
<span class="co">#&gt;    generics        0.0.2       2018-11-29 [2]</span>
<span class="co">#&gt;    ggplot2         3.3.1       2020-05-28 [2]</span>
<span class="co">#&gt;    glue            1.4.1       2020-05-13 [2]</span>
<span class="co">#&gt;    gtable          0.3.0       2019-03-25 [2]</span>
<span class="co">#&gt;    gtools          3.8.2       2020-03-31 [2]</span>
<span class="co">#&gt;    hms             0.5.3       2020-01-08 [2]</span>
<span class="co">#&gt;    htmltools       0.4.0       2019-10-04 [2]</span>
<span class="co">#&gt;    httr            1.4.1       2019-08-05 [2]</span>
<span class="co">#&gt;    kableExtra    * 1.1.0       2019-03-16 [2]</span>
<span class="co">#&gt;    knitr         * 1.28        2020-02-06 [2]</span>
<span class="co">#&gt;    lifecycle       0.2.0       2020-03-06 [2]</span>
<span class="co">#&gt;    lotri           0.2.2       2020-05-29 [2]</span>
<span class="co">#&gt;    magrittr        1.5         2014-11-22 [2]</span>
<span class="co">#&gt;    MASS            7.3-51.6    2020-04-26 [2]</span>
<span class="co">#&gt;    memoise         1.1.0       2017-04-21 [2]</span>
<span class="co">#&gt;    mrgsolve      * 0.10.1      2020-02-21 [2]</span>
<span class="co">#&gt;    munsell         0.5.0       2018-06-12 [2]</span>
<span class="co">#&gt;    mvnfast         0.2.5       2018-01-31 [2]</span>
<span class="co">#&gt;    mvtnorm         1.1-0       2020-02-24 [2]</span>
<span class="co">#&gt;    pillar          1.4.4       2020-05-05 [2]</span>
<span class="co">#&gt;    pkgbuild        1.0.8       2020-05-07 [2]</span>
<span class="co">#&gt;    pkgconfig       2.0.3       2019-09-22 [2]</span>
<span class="co">#&gt;    pkgdown         1.5.1       2020-04-09 [2]</span>
<span class="co">#&gt;    pkgload         1.1.0       2020-05-29 [2]</span>
<span class="co">#&gt;    PKPDsim       * 1.0.7       2020-04-29 [2]</span>
<span class="co">#&gt;  P PopED         * 0.5.0       2020-06-13 [?]</span>
<span class="co">#&gt;    PreciseSums     0.3         2018-04-12 [2]</span>
<span class="co">#&gt;    prettyunits     1.1.1       2020-01-24 [2]</span>
<span class="co">#&gt;    processx        3.4.2       2020-02-09 [2]</span>
<span class="co">#&gt;    ps              1.3.3       2020-05-08 [2]</span>
<span class="co">#&gt;    purrr           0.3.4       2020-04-17 [2]</span>
<span class="co">#&gt;    R6              2.4.1       2019-11-12 [2]</span>
<span class="co">#&gt;    Rcpp          * 1.0.4.6     2020-04-09 [2]</span>
<span class="co">#&gt;    RcppArmadillo   0.9.880.1.0 2020-05-17 [2]</span>
<span class="co">#&gt;    readr           1.3.1       2018-12-21 [2]</span>
<span class="co">#&gt;    remotes         2.1.1       2020-02-15 [2]</span>
<span class="co">#&gt;    rlang           0.4.6       2020-05-02 [2]</span>
<span class="co">#&gt;    rmarkdown       2.2         2020-05-31 [2]</span>
<span class="co">#&gt;    rprojroot       1.3-2       2018-01-03 [2]</span>
<span class="co">#&gt;    rstudioapi      0.11        2020-02-07 [2]</span>
<span class="co">#&gt;    rvest           0.3.5       2019-11-08 [2]</span>
<span class="co">#&gt;    RxODE         * 0.9.2-0     2020-03-13 [2]</span>
<span class="co">#&gt;    scales          1.1.1       2020-05-11 [2]</span>
<span class="co">#&gt;    sessioninfo     1.1.1       2018-11-05 [2]</span>
<span class="co">#&gt;    stringi         1.4.6       2020-02-17 [2]</span>
<span class="co">#&gt;    stringr         1.4.0       2019-02-10 [2]</span>
<span class="co">#&gt;    testthat      * 2.3.2       2020-03-02 [2]</span>
<span class="co">#&gt;    tibble          3.0.1       2020-04-20 [2]</span>
<span class="co">#&gt;    tidyselect      1.1.0       2020-05-11 [2]</span>
<span class="co">#&gt;    units           0.6-6       2020-03-16 [2]</span>
<span class="co">#&gt;    usethis         1.6.1       2020-04-29 [2]</span>
<span class="co">#&gt;    vctrs           0.3.1       2020-06-05 [2]</span>
<span class="co">#&gt;    viridisLite     0.3.0       2018-02-01 [2]</span>
<span class="co">#&gt;    webshot         0.5.2       2019-11-22 [2]</span>
<span class="co">#&gt;    withr           2.2.0       2020-04-20 [2]</span>
<span class="co">#&gt;    xfun            0.14        2020-05-20 [2]</span>
<span class="co">#&gt;    xml2            1.3.2       2020-04-23 [2]</span>
<span class="co">#&gt;    yaml            2.2.1       2020-02-01 [2]</span>
<span class="co">#&gt;  source                            </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.1)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.1)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.1)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  Github (InsightRX/PKPDsim@bd9b9e4)</span>
<span class="co">#&gt;  local                             </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  CRAN (R 4.0.0)                    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] /private/var/folders/pl/wj3tbf3s19db0h0p_j11_jym0000gp/T/RtmpfqCcRc/temp_libpath2b86141e5380</span>
<span class="co">#&gt; [2] /Library/Frameworks/R.framework/Versions/4.0/Resources/library</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  P â”€â”€ Loaded and on-disk path mismatch.</span>
<span class="co">#sessionInfo()</span></pre></body></html></div>
<!-- # References {-} -->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://katalog.uu.se/profile/?id=N4-631">Andrew C. Hooker</a>, Marco Foracchia, <a href="https://katalog.uu.se/profile/?id=N9-467">Sebastian Ueckert</a>, <a href="https://scholar.google.se/citations?user=4CgHwr0AAAAJ&amp;hl=en">Joakim Nyberg</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
