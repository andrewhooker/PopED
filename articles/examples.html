<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PopED">
<title>Examples • PopED</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Examples">
<meta property="og:description" content="PopED">
<meta property="og:image" content="https://andrewhooker.github.io/PopED/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PopED</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.6.0.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/intro-poped.html">Introduction</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/examples.html">Examples</a>
    <a class="dropdown-item" href="../articles/model_def_other_pkgs.html">Defining models for PopED using R based PKPD simulators</a>
    <a class="dropdown-item" href="../articles/handling_LOQ.html">Optimal design with LOQ data in PopED</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/andrewhooker/PopED">
    <span class="fab fa fab fa-github fa-lg"></span>
     
    Source
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Examples</h1>
                        <h4 data-toc-skip class="author">Giulia Lestini,
Martin Fink and Andrew Hooker</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/andrewhooker/PopED/blob/HEAD/vignettes/examples.Rmd" class="external-link"><code>vignettes/examples.Rmd</code></a></small>
      <div class="d-none name"><code>examples.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we try to highlight PopED features that may be
useful. Only code related to specific features we would like to
highlight is described here in this vignette. These features (and more)
are presented as r-scripts in the “examples” folder in the PopED
installation directory. You can view a list of these example files using
the commands:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, package<span class="op">=</span><span class="st">"PopED"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">ex_dir</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "ex.1.a.PK.1.comp.oral.md.intro.R"          </span></span>
<span><span class="co">#&gt;  [2] "ex.1.b.PK.1.comp.oral.md.re-parameterize.R"</span></span>
<span><span class="co">#&gt;  [3] "ex.1.c.PK.1.comp.oral.md.ODE.compiled.R"   </span></span>
<span><span class="co">#&gt;  [4] "ex.10.PKPD.HCV.compiled.R"                 </span></span>
<span><span class="co">#&gt;  [5] "ex.11.PK.prior.R"                          </span></span>
<span><span class="co">#&gt;  [6] "ex.12.covariate.distributions.R"           </span></span>
<span><span class="co">#&gt;  [7] "ex.13.shrinkage.R"                         </span></span>
<span><span class="co">#&gt;  [8] "ex.14.PK.IOV.R"                            </span></span>
<span><span class="co">#&gt;  [9] "ex.15.full.covariance.matrix.R"            </span></span>
<span><span class="co">#&gt; [10] "ex.2.a.warfarin.evaluate.R"                </span></span>
<span><span class="co">#&gt; [11] "ex.2.b.warfarin.optimize.R"                </span></span>
<span><span class="co">#&gt; [12] "ex.2.c.warfarin.ODE.compiled.R"            </span></span>
<span><span class="co">#&gt; [13] "ex.2.d.warfarin.ED.R"                      </span></span>
<span><span class="co">#&gt; [14] "ex.2.e.warfarin.Ds.R"                      </span></span>
<span><span class="co">#&gt; [15] "ex.3.a.PKPD.1.comp.oral.md.imax.D-opt.R"   </span></span>
<span><span class="co">#&gt; [16] "ex.3.b.PKPD.1.comp.oral.md.imax.ED-opt.R"  </span></span>
<span><span class="co">#&gt; [17] "ex.4.PKPD.1.comp.emax.R"                   </span></span>
<span><span class="co">#&gt; [18] "ex.5.PD.emax.hill.R"                       </span></span>
<span><span class="co">#&gt; [19] "ex.6.PK.1.comp.oral.sd.R"                  </span></span>
<span><span class="co">#&gt; [20] "ex.7.PK.1.comp.maturation.R"               </span></span>
<span><span class="co">#&gt; [21] "ex.8.tmdd_qss_one_target_compiled.R"       </span></span>
<span><span class="co">#&gt; [22] "ex.9.PK.2.comp.oral.md.ode.compiled.R"     </span></span>
<span><span class="co">#&gt; [23] "HCV_ode.c"                                 </span></span>
<span><span class="co">#&gt; [24] "one_comp_oral_CL.c"                        </span></span>
<span><span class="co">#&gt; [25] "tmdd_qss_one_target.c"                     </span></span>
<span><span class="co">#&gt; [26] "two_comp_oral_CL.c"</span></span></code></pre></div>
<p>You can then open one of the examples (for example,
<code>ex.1.a.PK.1.comp.oral.md.intro.R</code>) using the following
code</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_name</span> <span class="op">&lt;-</span> <span class="st">"ex.1.a.PK.1.comp.oral.md.intro.R"</span></span>
<span></span>
<span><span class="va">ex_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>,<span class="va">file_name</span>,package<span class="op">=</span><span class="st">"PopED"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">ex_file</span>,<span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,overwrite <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/file.edit.html" class="external-link">file.edit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="va">file_name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The table below provides a check list of features for each of the 15
available examples.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th>Features</th>
<th>Ex1</th>
<th>Ex2</th>
<th>Ex3</th>
<th>Ex4</th>
<th>Ex5</th>
<th>Ex6</th>
<th>Ex7</th>
<th>Ex8</th>
<th>Ex9</th>
<th>Ex10</th>
<th>Ex11</th>
<th>Ex12</th>
<th>Ex13</th>
<th>Ex14</th>
<th>Ex15</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Analytic model</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="even">
<td>ODE model</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Irregular dosing</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Full cov matrix W</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr class="odd">
<td>Inter-occ variability</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="even">
<td>Discrete covariates</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Continuous covariates</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="even">
<td>Multiple arms</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Multi response models</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Designs differ <br> across responses</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Calculate precision <br>of derived parameters</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Power calculation</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Include previous FIM</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Shrinkage/Bayesian FIM</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Discrete optimization</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="even">
<td>Optimization <br> of multi-group designs<br> (same response)</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Different optimal<br> sampling times<br> between groups</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Optimization with constraining <br> sampling times</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Optimization of subjects <br>per group</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><em>Note:</em> All features are available in PopED but some are not
demonstrated in the supplied examples.</p>
</div>
<div class="section level2">
<h2 id="analytic-solution-of-pkpd-model-multiple-study-arms">Analytic solution of PKPD model, multiple study arms<a class="anchor" aria-label="anchor" href="#analytic-solution-of-pkpd-model-multiple-study-arms"></a>
</h2>
<p>The full code for this example is available in
<code>ex.4.PKPD.1.comp.emax.R</code>.</p>
<p>Here we define a PKPD mode using analytical equations. The PK is a
one compartment model with intravenous bolus administration and linear
elimination. The PD is an ordinary Emax model driven by the PK
concentrations. The expected output of each measurement (PK or PD) is
given in the vector <code>model_switch</code> (see below for
details).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrewhooker.github.io/PopED/">PopED</a></span><span class="op">)</span></span>
<span><span class="va">f_pkpdmodel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>,<span class="va">xt</span>,<span class="va">parameters</span>,<span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="va">xt</span></span>
<span>    <span class="va">MS</span> <span class="op">&lt;-</span> <span class="va">model_switch</span></span>
<span>    </span>
<span>    <span class="co"># PK model</span></span>
<span>    <span class="va">CONC</span> <span class="op">=</span> <span class="va">DOSE</span><span class="op">/</span><span class="va">V</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">CL</span><span class="op">/</span><span class="va">V</span><span class="op">*</span><span class="va">xt</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="co"># PD model</span></span>
<span>    <span class="va">EFF</span> <span class="op">=</span> <span class="va">E0</span> <span class="op">+</span> <span class="va">CONC</span><span class="op">*</span><span class="va">EMAX</span><span class="op">/</span><span class="op">(</span><span class="va">EC50</span> <span class="op">+</span> <span class="va">CONC</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">MS</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">CONC</span><span class="op">[</span><span class="va">MS</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">MS</span><span class="op">==</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">EFF</span><span class="op">[</span><span class="va">MS</span><span class="op">==</span><span class="fl">2</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> y<span class="op">=</span> <span class="va">y</span>,poped.db<span class="op">=</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The error model also has to accommodate both response models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## -- Residual Error function</span></span>
<span><span class="co">## -- Proportional PK + additive PD</span></span>
<span><span class="va">f_Err</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>,<span class="va">xt</span>,<span class="va">parameters</span>,<span class="va">epsi</span>,<span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">returnArgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">ff_pointer</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">model_switch</span>,<span class="va">xt</span>,<span class="va">parameters</span>,<span class="va">poped.db</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">returnArgs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">poped.db</span> <span class="op">&lt;-</span> <span class="va">returnArgs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">MS</span> <span class="op">&lt;-</span> <span class="va">model_switch</span></span>
<span>  </span>
<span>  <span class="va">prop.err</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">epsi</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">add.err</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">+</span><span class="va">epsi</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">y</span><span class="op">[</span><span class="va">MS</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">prop.err</span><span class="op">[</span><span class="va">MS</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">y</span><span class="op">[</span><span class="va">MS</span><span class="op">==</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">add.err</span><span class="op">[</span><span class="va">MS</span><span class="op">==</span><span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> y<span class="op">=</span> <span class="va">y</span>,poped.db <span class="op">=</span><span class="va">poped.db</span> <span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>In the <code>poped.db</code> object the vector we specify
<code>model_switch</code> in order to assign the sampling times defined
in the vector <code>xt</code> to the PK (=1) or PD (=2) model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co"># Model</span></span>
<span>  ff_fun<span class="op">=</span><span class="va">f_pkpdmodel</span>,</span>
<span>  fError_fun<span class="op">=</span><span class="va">f_Err</span>,</span>
<span>  fg_fun<span class="op">=</span><span class="va">f_etaToParam</span>,</span>
<span>  sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>,<span class="fl">0.015</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.5</span>,V<span class="op">=</span><span class="fl">0.2</span>,E0<span class="op">=</span><span class="fl">1</span>,EMAX<span class="op">=</span><span class="fl">1</span>,EC50<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,  </span>
<span>  d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.09</span>,V<span class="op">=</span><span class="fl">0.09</span>,E0<span class="op">=</span><span class="fl">0.04</span>,EC50<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span>, </span>
<span>  </span>
<span>  <span class="co"># Design</span></span>
<span>  groupsize<span class="op">=</span><span class="fl">20</span>,</span>
<span>  m<span class="op">=</span><span class="fl">3</span>,</span>
<span>  xt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>,<span class="fl">0.66</span>,<span class="fl">0.9</span>,<span class="fl">5</span>,<span class="fl">0.1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  model_switch<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>  a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># Design space</span></span>
<span>  minxt<span class="op">=</span><span class="fl">0</span>,</span>
<span>  maxxt<span class="op">=</span><span class="fl">5</span>,</span>
<span>  bUseGrouped_xt<span class="op">=</span><span class="fl">1</span>,</span>
<span>  maxa<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  mina<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The model predictions below show typical PK and PD profiles for three
dose groups and the expected 95% prediction interval of the data. The
initial design, as shown in the <code>poped.db</code> object, consists
of 3 arms with doses of 0, 1, and 2 mg; PK sampling times are 0.33,
0.66, 0.9, and 5 hours/days; PD sampling times are 0.1, 1, 2, and 5
hours/days. With <code>model.names=c("PK","PD")</code> one can name the
outputs in the graph.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span></span>
<span>  <span class="va">poped.db</span>,PI<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>  facet_scales<span class="op">=</span><span class="st">"free"</span>,</span>
<span>  separate.groups<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>  model.names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PK"</span>,<span class="st">"PD"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="examples_files/figure-html/simulate_multi-response_model-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="ode-solution-of-pk-model-multiple-dosing">ODE solution of PK model, multiple dosing<a class="anchor" aria-label="anchor" href="#ode-solution-of-pk-model-multiple-dosing"></a>
</h2>
<p>The full code for this example is available in
<code>ex.9.PK.2.comp.oral.md.ode.compiled.R</code>.</p>
<p>In this example, the <code>deSolve</code> library needs to be
installed for computing solutions to a system of differential equations.
For faster solutions one can use pre-compiled code using the
<code>Rcpp</code> library (see below).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span></code></pre></div>
<p>Here we define the two compartment model in R using deSolve
notation</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PK.2.comp.oral.ode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Time</span>, <span class="va">State</span>, <span class="va">Pars</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">State</span>, <span class="va">Pars</span><span class="op">)</span><span class="op">)</span>, <span class="op">{</span>    </span>
<span>    <span class="va">dA1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">KA</span><span class="op">*</span><span class="va">A1</span> </span>
<span>    <span class="va">dA2</span> <span class="op">&lt;-</span> <span class="va">KA</span><span class="op">*</span><span class="va">A1</span> <span class="op">+</span> <span class="va">A3</span><span class="op">*</span> <span class="va">Q</span><span class="op">/</span><span class="va">V2</span> <span class="op">-</span><span class="va">A2</span><span class="op">*</span><span class="op">(</span><span class="va">CL</span><span class="op">/</span><span class="va">V1</span><span class="op">+</span><span class="va">Q</span><span class="op">/</span><span class="va">V1</span><span class="op">)</span></span>
<span>    <span class="va">dA3</span> <span class="op">&lt;-</span> <span class="va">A2</span><span class="op">*</span> <span class="va">Q</span><span class="op">/</span><span class="va">V1</span><span class="op">-</span><span class="va">A3</span><span class="op">*</span> <span class="va">Q</span><span class="op">/</span><span class="va">V2</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dA1</span>, <span class="va">dA2</span>, <span class="va">dA3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we define the initial conditions of the ODE system
<code>A_ini</code> with a named vector, in this case all compartments
are initialized to zero <code>c(A1=0,A2=0,A3=0)</code>. The dosing input
is defined as a data.frame <code>dose_dat</code> referring to the named
compartment <code>var = c("A1")</code>, the specified
<code>dose_times</code> and <code>value=c(DOSE*Favail)</code> dose
amounts. Note that the covariates <code>DOSE</code> and the regimen
<code>TAU</code> can differ by arm and be optimized (as shown in
<code>ex.1.a.PK.1.comp.oral.md.intro.R</code>). For more information see
the help pages for <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">?deSolve::ode</a></code> and
<code><a href="https://rdrr.io/pkg/deSolve/man/events.html" class="external-link">?deSolve::events</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ff.PK.2.comp.oral.md.ode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>, <span class="va">xt</span>, <span class="va">parameters</span>, <span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># initial conditions of ODE system</span></span>
<span>    <span class="va">A_ini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A1<span class="op">=</span><span class="fl">0</span>, A2<span class="op">=</span><span class="fl">0</span>, A3<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">#Set up time points to get ODE solutions</span></span>
<span>    <span class="va">times_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span> <span class="co"># sample times</span></span>
<span>    <span class="va">times_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="co"># add extra time for start of study</span></span>
<span>    <span class="va">times_dose</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times_xt</span><span class="op">)</span>,by<span class="op">=</span><span class="va">TAU</span><span class="op">)</span> <span class="co"># dose times</span></span>
<span>    <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">times_start</span>,<span class="va">times_xt</span>,<span class="va">times_dose</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># combine it all</span></span>
<span>    </span>
<span>    <span class="co"># Dosing</span></span>
<span>    <span class="va">dose_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span><span class="op">)</span>, </span>
<span>      time <span class="op">=</span> <span class="va">times_dose</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">DOSE</span><span class="op">*</span><span class="va">Favail</span><span class="op">)</span>, </span>
<span>      method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"add"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span><span class="va">A_ini</span>, <span class="va">times</span>, <span class="va">PK.2.comp.oral.ode</span>, <span class="va">parameters</span>,</span>
<span>               events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dose_dat</span><span class="op">)</span><span class="op">)</span><span class="co">#atol=1e-13,rtol=1e-13)</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"A2"</span><span class="op">]</span><span class="op">/</span><span class="va">V1</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">times_xt</span>,<span class="va">out</span><span class="op">[</span>,<span class="st">"time"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,poped.db<span class="op">=</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>When creating a PopED database. <code>ff_fun</code> should point to
the function providing the solution to the ODE. Further, the names in
the parameter definition (<code>fg</code>) function should match the
parameters used in the above two functions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co"># Model</span></span>
<span>  ff_fun<span class="op">=</span><span class="st">"ff.PK.2.comp.oral.md.ode"</span>,</span>
<span>  fError_fun<span class="op">=</span><span class="st">"feps.add.prop"</span>,</span>
<span>  fg_fun<span class="op">=</span><span class="st">"fg"</span>,</span>
<span>  sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.1</span><span class="op">^</span><span class="fl">2</span>,add<span class="op">=</span><span class="fl">0.05</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">10</span>,V1<span class="op">=</span><span class="fl">100</span>,KA<span class="op">=</span><span class="fl">1</span>,Q<span class="op">=</span> <span class="fl">3.0</span>, V2<span class="op">=</span> <span class="fl">40.0</span>, Favail<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.15</span><span class="op">^</span><span class="fl">2</span>,KA<span class="op">=</span><span class="fl">0.25</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Design</span></span>
<span>  groupsize<span class="op">=</span><span class="fl">20</span>,</span>
<span>  m<span class="op">=</span><span class="fl">1</span>,      <span class="co">#number of groups</span></span>
<span>  xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">48</span>,<span class="fl">50</span>,<span class="fl">55</span>,<span class="fl">65</span>,<span class="fl">70</span>,<span class="fl">85</span>,<span class="fl">90</span>,<span class="fl">120</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Design space </span></span>
<span>  minxt<span class="op">=</span><span class="fl">0</span>,</span>
<span>  maxxt<span class="op">=</span><span class="fl">144</span>,</span>
<span>  discrete_xt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">144</span><span class="op">)</span>,</span>
<span>  a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">100</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,</span>
<span>  discrete_a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span>,by<span class="op">=</span><span class="fl">100</span><span class="op">)</span>,TAU<span class="op">=</span><span class="fl">8</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We plot the population prediction of the model for the initial
design</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped.db</span>,model_num_points <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="examples_files/figure-html/simulate_ODE_model-1.png" width="80%" style="display: block; margin: auto;"></p>
<p><strong>Faster computations with Rcpp:</strong> We could also define
the system using Rcpp, which will produce compiled code that should run
faster (further examples in
<code>ex.2.c.warfarin.ODE.compiled.R</code>). First we redefine the ODE
system using Rcpp.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rcpp.org" class="external-link">Rcpp</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span></span>
<span>  <span class="st">'List two_comp_oral_ode_Rcpp(double Time, NumericVector A, NumericVector Pars) {</span></span>
<span><span class="st">     int n = A.size();</span></span>
<span><span class="st">     NumericVector dA(n);</span></span>
<span><span class="st">            </span></span>
<span><span class="st">     double CL = Pars[0];</span></span>
<span><span class="st">     double V1 = Pars[1];</span></span>
<span><span class="st">     double KA = Pars[2];</span></span>
<span><span class="st">     double Q  = Pars[3];</span></span>
<span><span class="st">     double V2 = Pars[4];</span></span>
<span><span class="st">            </span></span>
<span><span class="st">     dA[0] = -KA*A[0];</span></span>
<span><span class="st">     dA[1] = KA*A[0] - (CL/V1)*A[1] - Q/V1*A[1] + Q/V2*A[2];</span></span>
<span><span class="st">     dA[2] = Q/V1*A[1] - Q/V2*A[2];</span></span>
<span><span class="st">     return List::create(dA);</span></span>
<span><span class="st">  }'</span><span class="op">)</span></span></code></pre></div>
<p>Next we add the compiled function
(<code>two_comp_oral_ode_Rcpp</code>) in the ODE solver.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ff.PK.2.comp.oral.md.ode.Rcpp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>, <span class="va">xt</span>, <span class="va">parameters</span>, <span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># initial conditions of ODE system</span></span>
<span>    <span class="va">A_ini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A1<span class="op">=</span><span class="fl">0</span>, A2<span class="op">=</span><span class="fl">0</span>, A3<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">#Set up time points to get ODE solutions</span></span>
<span>    <span class="va">times_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span> <span class="co"># sample times</span></span>
<span>    <span class="va">times_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="co"># add extra time for start of study</span></span>
<span>    <span class="va">times_dose</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times_xt</span><span class="op">)</span>,by<span class="op">=</span><span class="va">TAU</span><span class="op">)</span> <span class="co"># dose times</span></span>
<span>    <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">times_start</span>,<span class="va">times_xt</span>,<span class="va">times_dose</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># combine it all</span></span>
<span>    </span>
<span>    <span class="co"># Dosing</span></span>
<span>    <span class="va">dose_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span><span class="op">)</span>, </span>
<span>      time <span class="op">=</span> <span class="va">times_dose</span>,</span>
<span>      value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">DOSE</span><span class="op">*</span><span class="va">Favail</span><span class="op">)</span>, </span>
<span>      method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"add"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Here "two_comp_oral_ode_Rcpp" is equivalent </span></span>
<span>    <span class="co"># to the non-compiled version "PK.2.comp.oral.ode".</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span><span class="va">A_ini</span>, <span class="va">times</span>, <span class="va">two_comp_oral_ode_Rcpp</span>, <span class="va">parameters</span>,</span>
<span>               events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dose_dat</span><span class="op">)</span><span class="op">)</span><span class="co">#atol=1e-13,rtol=1e-13)</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"A2"</span><span class="op">]</span><span class="op">/</span><span class="va">V1</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">times_xt</span>,<span class="va">out</span><span class="op">[</span>,<span class="st">"time"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,poped.db<span class="op">=</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Finally we create a poped database to use these functions by updating
the previously created database.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db.Rcpp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>  <span class="va">poped.db</span>,</span>
<span>  ff_fun<span class="op">=</span><span class="st">"ff.PK.2.comp.oral.md.ode.Rcpp"</span><span class="op">)</span></span></code></pre></div>
<p>We can compare the time for design evaluation with these two methods
of describing the same model.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>; <span class="va">eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">)</span>; <span class="fu"><a href="../reference/toc.html">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Elapsed time: 2.759 seconds.</span></span>
<span><span class="fu"><a href="../reference/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>; <span class="va">eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db.Rcpp</span><span class="op">)</span>; <span class="fu"><a href="../reference/toc.html">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Elapsed time: 1.318 seconds.</span></span></code></pre></div>
<p>The difference is noticeable and gets larger for more complex ODE
models.</p>
</div>
<div class="section level2">
<h2 id="ode-solution-of-tmdd-model-with-2-outputs-multiple-arms-different-dose-routes-different-number-of-sample-times-per-arm">ODE solution of TMDD model with 2 outputs, Multiple arms, different
dose routes, different number of sample times per arm<a class="anchor" aria-label="anchor" href="#ode-solution-of-tmdd-model-with-2-outputs-multiple-arms-different-dose-routes-different-number-of-sample-times-per-arm"></a>
</h2>
<p>The full code for this example is available in
<code>ex.8.tmdd_qss_one_target_compiled.R</code>.</p>
<p>In the function that defines the dosing and derives the ODE solution,
the discrete covariate <code>SC_FLAG</code> is used to give the dose
either into <code>A1</code> or <code>A2</code>, the sub-cutaneous or the
IV compartment.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmdd_qss_one_target_model_compiled</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>,<span class="va">xt</span>,<span class="va">parameters</span>,<span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="va">xt</span></span>
<span>    </span>
<span>    <span class="co">#The initialization vector for the compartment</span></span>
<span>    <span class="va">A_ini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A1<span class="op">=</span><span class="va">DOSE</span><span class="op">*</span><span class="va">SC_FLAG</span>,</span>
<span>               A2<span class="op">=</span><span class="va">DOSE</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">SC_FLAG</span><span class="op">)</span>,</span>
<span>               A3<span class="op">=</span><span class="fl">0</span>,</span>
<span>               A4<span class="op">=</span><span class="va">R0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#Set up time points for the ODE</span></span>
<span>    <span class="va">times_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span></span>
<span>    <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">times_xt</span><span class="op">)</span></span>
<span>    <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">times</span><span class="op">)</span> <span class="co">## add extra time for start of integration</span></span>
<span>    </span>
<span>    <span class="co"># solve the ODE</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span><span class="va">A_ini</span>, <span class="va">times</span>, <span class="va">tmdd_qss_one_target_model_ode</span>, <span class="va">parameters</span><span class="op">)</span><span class="co">#,atol=1e-13,rtol=1e-13)</span></span>
<span>    </span>
<span>    </span>
<span>    <span class="co"># extract the time points of the observations</span></span>
<span>    <span class="va">out</span> <span class="op">=</span> <span class="va">out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">times_xt</span>,<span class="va">out</span><span class="op">[</span>,<span class="st">"time"</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>    </span>
<span>    <span class="co"># Match ODE output to measurements</span></span>
<span>    <span class="va">RTOT</span> <span class="op">=</span> <span class="va">out</span><span class="op">[</span>,<span class="st">"A4"</span><span class="op">]</span></span>
<span>    <span class="va">CTOT</span> <span class="op">=</span> <span class="va">out</span><span class="op">[</span>,<span class="st">"A2"</span><span class="op">]</span><span class="op">/</span><span class="va">V1</span></span>
<span>    <span class="va">CFREE</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">CTOT</span><span class="op">-</span><span class="va">RTOT</span><span class="op">-</span><span class="va">KSSS</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">CTOT</span><span class="op">-</span><span class="va">RTOT</span><span class="op">-</span><span class="va">KSSS</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">+</span><span class="fl">4</span><span class="op">*</span><span class="va">KSSS</span><span class="op">*</span><span class="va">CTOT</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">COMPLEX</span><span class="op">=</span><span class="op">(</span><span class="op">(</span><span class="va">RTOT</span><span class="op">*</span><span class="va">CFREE</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">KSSS</span><span class="op">+</span><span class="va">CFREE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">RFREE</span><span class="op">=</span> <span class="va">RTOT</span><span class="op">-</span><span class="va">COMPLEX</span></span>
<span>    </span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">model_switch</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span><span class="op">=</span> <span class="va">RTOT</span><span class="op">[</span><span class="va">model_switch</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">model_switch</span><span class="op">==</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span><span class="va">CFREE</span><span class="op">[</span><span class="va">model_switch</span><span class="op">==</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="co">#y[model_switch==3]=RFREE[model_switch==3]</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> y<span class="op">=</span><span class="va">y</span>,poped.db<span class="op">=</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<!-- Finally we define the residual unexplained variability model. -->
<p>Two different sub-studies are defined, with different sampling times
per arm - in terms of total number of samples and the actual times<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Study 1 and 2 from table 2 in: Gibiansky, L., Gibiansky,
E., &amp;amp; Bauer, R. (2012). Comparison of Nonmem 7.2 estimation methods
and parallel processing efficiency on a target-mediated drug disposition
model. Journal of Pharmacokinetics and Pharmacodynamics, 39(1), 17–35.
&lt;a href="https://doi.org/10.1007/s10928-011-9228-y" class="external-link uri"&gt;https://doi.org/10.1007/s10928-011-9228-y&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>. Due to
this difference in numbers and the relatively complicated study design
we define the sample times (<code>xt</code>), what each sample time will
measure (<code>model_switch</code>) and which samples should be taken at
the same study time (<code>G_xt</code>) as matrices. Here three
variables <code>xt</code>, <code>model_switch</code>, and
<code>G_xt</code> are matrices with each row representing one arm, and
the number of columns is the maximum number of samples (for all
endpoints) in any of the arms (i.e., <code>max(ni)</code>). To be clear
about which elements in the matrices should be considered we specify the
number of samples per arm by defining the vector <code>ni</code> in the
<code>create.poped.database</code> function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zeros.html">zeros</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">study_1_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0417</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">7</span>,<span class="fl">14</span>,<span class="fl">21</span>,<span class="fl">28</span>,<span class="fl">35</span>,<span class="fl">42</span>,<span class="fl">49</span>,<span class="fl">56</span><span class="op">)</span>,<span class="fl">8</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">4</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">study_2_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0417</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">7</span>,<span class="fl">14</span>,<span class="fl">21</span>,<span class="fl">28</span>,<span class="fl">56</span>,<span class="fl">63</span>,<span class="fl">70</span>,<span class="fl">77</span>,<span class="fl">84</span>,<span class="fl">91</span>,<span class="fl">98</span>,<span class="fl">105</span><span class="op">)</span>,<span class="fl">4</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">xt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">26</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">study_1_xt</span></span>
<span><span class="va">xt</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">study_2_xt</span></span>
<span></span>
<span><span class="va">model_switch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zeros.html">zeros</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">model_switch</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">model_switch</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">14</span><span class="op">:</span><span class="fl">26</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">model_switch</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">model_switch</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">16</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">G_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/zeros.html">zeros</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">study_1_G_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span>,<span class="fl">8</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">4</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">study_2_G_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span><span class="op">:</span><span class="fl">28</span><span class="op">)</span>,<span class="fl">4</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">G_xt</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">26</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">study_1_G_xt</span></span>
<span><span class="va">G_xt</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">study_2_G_xt</span></span></code></pre></div>
<p>These can then be plugged into the normal <code>poped.db</code>
setup.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co"># Model</span></span>
<span>  ff_fun<span class="op">=</span><span class="va">tmdd_qss_one_target_model_compiled</span>,</span>
<span>  fError_fun<span class="op">=</span><span class="va">tmdd_qss_one_target_model_ruv</span>,</span>
<span>  fg_fun<span class="op">=</span><span class="va">sfg</span>,</span>
<span>  sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>rtot_add<span class="op">=</span><span class="fl">0.04</span>,cfree_add<span class="op">=</span><span class="fl">0.0225</span><span class="op">)</span>,</span>
<span>  bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.3</span>,V1<span class="op">=</span><span class="fl">3</span>,Q<span class="op">=</span><span class="fl">0.2</span>,V2<span class="op">=</span><span class="fl">3</span>,FAVAIL<span class="op">=</span><span class="fl">0.7</span>,KA<span class="op">=</span><span class="fl">0.5</span>,VMAX<span class="op">=</span><span class="fl">0</span>,</span>
<span>         KMSS<span class="op">=</span><span class="fl">0</span>,R0<span class="op">=</span><span class="fl">0.1</span>,KSSS<span class="op">=</span><span class="fl">0.015</span>,KDEG<span class="op">=</span><span class="fl">10</span>,KINT<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.09</span>,V1<span class="op">=</span><span class="fl">0.09</span>,Q<span class="op">=</span><span class="fl">0.04</span>,V2<span class="op">=</span><span class="fl">0.04</span>,FAVAIL<span class="op">=</span><span class="fl">0.04</span>,</span>
<span>      KA<span class="op">=</span><span class="fl">0.16</span>,VMAX<span class="op">=</span><span class="fl">0</span>,KMSS<span class="op">=</span><span class="fl">0</span>,R0<span class="op">=</span><span class="fl">0.09</span>,KSSS<span class="op">=</span><span class="fl">0.09</span>,KDEG<span class="op">=</span><span class="fl">0.04</span>,</span>
<span>      KINT<span class="op">=</span><span class="fl">0.04</span><span class="op">)</span>,</span>
<span>  notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  notfixed_d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Design</span></span>
<span>  groupsize<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">100</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>  m<span class="op">=</span><span class="fl">6</span>,      <span class="co">#number of groups</span></span>
<span>  xt<span class="op">=</span><span class="va">xt</span>,</span>
<span>  model_switch<span class="op">=</span><span class="va">model_switch</span>,</span>
<span>  ni<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">26</span>,<span class="fl">26</span>,<span class="fl">26</span>,<span class="fl">26</span>,<span class="fl">30</span>,<span class="fl">30</span><span class="op">)</span>,</span>
<span>  a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">100</span>, SC_FLAG<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">300</span>, SC_FLAG<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">600</span>, SC_FLAG<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">1000</span>, SC_FLAG<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">600</span>, SC_FLAG<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">1000</span>, SC_FLAG<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Design space</span></span>
<span>  bUseGrouped_xt<span class="op">=</span><span class="fl">1</span>,</span>
<span>  G_xt<span class="op">=</span><span class="va">G_xt</span>,</span>
<span>  discrete_a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">1000</span>,by<span class="op">=</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>                    SC_FLAG<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can plot population predictions for each group and evaluate
the design.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped.db.2</span>,facet_scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span></span></code></pre></div>
<p><img src="examples_files/figure-html/simulate_different_dose_regimen-1.png" width="80%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eval_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">eval_2</span><span class="op">$</span><span class="va">rse</span><span class="op">)</span> <span class="co"># in percent</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">RSE in %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CL</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">V1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Q</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">V2</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">FAVAIL</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">KA</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">R0</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">KSSS</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">KDEG</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">KINT</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">d_CL</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">d_V1</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">d_Q</td>
<td align="right">22</td>
</tr>
<tr class="even">
<td align="left">d_V2</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">d_FAVAIL</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">d_KA</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">d_R0</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">d_KSSS</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">d_KDEG</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">d_KINT</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">sig_rtot_add</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">sig_cfree_add</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="model-with-continuous-covariates">Model with continuous covariates<a class="anchor" aria-label="anchor" href="#model-with-continuous-covariates"></a>
</h2>
<p>The R code for this example is available in
<code>ex.12.covariate_distributions.R</code>.</p>
<p>Let’s assume that we have a model with a covariate included in the
model description. Here we define a one-compartment PK model that uses
allometric scaling with a weight effect on both clearance and volume of
distribution.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>,<span class="va">xt</span>,<span class="va">parameters</span>,<span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="va">xt</span></span>
<span>    </span>
<span>    <span class="va">CL</span><span class="op">=</span><span class="va">CL</span><span class="op">*</span><span class="op">(</span><span class="va">WT</span><span class="op">/</span><span class="fl">70</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">WT_CL</span><span class="op">)</span></span>
<span>    <span class="va">V</span><span class="op">=</span><span class="va">V</span><span class="op">*</span><span class="op">(</span><span class="va">WT</span><span class="op">/</span><span class="fl">70</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="va">WT_V</span><span class="op">)</span></span>
<span>    <span class="va">DOSE</span><span class="op">=</span><span class="fl">1000</span><span class="op">*</span><span class="op">(</span><span class="va">WT</span><span class="op">/</span><span class="fl">70</span><span class="op">)</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="va">DOSE</span><span class="op">/</span><span class="va">V</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">CL</span><span class="op">/</span><span class="va">V</span><span class="op">*</span><span class="va">xt</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> y<span class="op">=</span> <span class="va">y</span>,poped.db<span class="op">=</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">par_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">a</span>,<span class="va">bpop</span>,<span class="va">b</span>,<span class="va">bocc</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">parameters</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> CL<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                V<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                WT_CL<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                WT_V<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>                WT<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span> <span class="va">parameters</span> <span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we define a design. In this case one group of individuals, where
we define the individuals’ typical weight as 70 kg
(<code>a=c(WT=70)</code>).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped_db</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>    ff_fun<span class="op">=</span><span class="va">mod_1</span>,</span>
<span>    fg_fun<span class="op">=</span><span class="va">par_1</span>,</span>
<span>    fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span>
<span>    groupsize<span class="op">=</span><span class="fl">50</span>,</span>
<span>    m<span class="op">=</span><span class="fl">1</span>,</span>
<span>    sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.015</span>,add<span class="op">=</span><span class="fl">0.0015</span><span class="op">)</span>,</span>
<span>    notfixed_sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">3.8</span>,V<span class="op">=</span><span class="fl">20</span>,WT_CL<span class="op">=</span><span class="fl">0.75</span>,WT_V<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>    d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.05</span>,V<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span>, </span>
<span>    xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span>,<span class="fl">24</span><span class="op">)</span>,</span>
<span>    minxt<span class="op">=</span><span class="fl">0</span>,</span>
<span>    maxxt<span class="op">=</span><span class="fl">24</span>,</span>
<span>    bUseGrouped_xt<span class="op">=</span><span class="fl">1</span>,</span>
<span>    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>WT<span class="op">=</span><span class="fl">70</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can create a plot of the model prediction for the typical
individual</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped_db</span><span class="op">)</span></span></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-24-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>And evaluate the initial design</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped_db</span><span class="op">)</span></span>
<span><span class="co">#&gt; Problems inverting the matrix. Results could be misleading.</span></span>
<span><span class="co">#&gt; Warning:   The following parameters are not estimable:</span></span>
<span><span class="co">#&gt;   WT_CL, WT_V</span></span>
<span><span class="co">#&gt;   Is the design adequate to estimate all parameters?</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] -Inf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                  CL          V WT_CL WT_V       d_CL        d_V   sig_prop</span></span>
<span><span class="co">#&gt; CL       65.8889583 -0.7145374     0    0    0.00000    0.00000      0.000</span></span>
<span><span class="co">#&gt; V        -0.7145374  2.2798156     0    0    0.00000    0.00000      0.000</span></span>
<span><span class="co">#&gt; WT_CL     0.0000000  0.0000000     0    0    0.00000    0.00000      0.000</span></span>
<span><span class="co">#&gt; WT_V      0.0000000  0.0000000     0    0    0.00000    0.00000      0.000</span></span>
<span><span class="co">#&gt; d_CL      0.0000000  0.0000000     0    0 9052.31524   29.49016   1424.255</span></span>
<span><span class="co">#&gt; d_V       0.0000000  0.0000000     0    0   29.49016 8316.09464   2483.900</span></span>
<span><span class="co">#&gt; sig_prop  0.0000000  0.0000000     0    0 1424.25450 2483.90024 440009.144</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;        CL         V     WT_CL      WT_V      d_CL       d_V  sig_prop </span></span>
<span><span class="co">#&gt;  3.247502  3.317107        NA        NA 21.026264 21.950179 10.061292</span></span></code></pre></div>
<p>From the output produced we see that the covariate parameters can not
be estimated according to this design calculation (RSE of WT_CL and WT_V
are <code>NA</code>). Why is that? Well, the calculation being done is
assuming that every individual in the group has the same covariate (to
speed up the calculation). This is clearly a poor assumption in this
case!</p>
<p><strong>Distribution of covariates:</strong> We can improve the
computation by assuming a distribution of the covariate (WT) in the
individuals in the study. We set <code>groupsize=1</code>, the number of
groups to be 50 (<code>m=50</code>) and assume that WT is sampled from a
normal distribution with mean=70 and sd=10
(<code>a=as.list(rnorm(50, mean = 70, sd = 10)</code>).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped_db_2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>    ff_fun<span class="op">=</span><span class="va">mod_1</span>,</span>
<span>    fg_fun<span class="op">=</span><span class="va">par_1</span>,</span>
<span>    fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span>
<span>    groupsize<span class="op">=</span><span class="fl">1</span>,</span>
<span>    m<span class="op">=</span><span class="fl">50</span>,</span>
<span>    sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.015</span>,add<span class="op">=</span><span class="fl">0.0015</span><span class="op">)</span>,</span>
<span>    notfixed_sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">1</span>,add<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>    bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">3.8</span>,V<span class="op">=</span><span class="fl">20</span>,WT_CL<span class="op">=</span><span class="fl">0.75</span>,WT_V<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>    d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.05</span>,V<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span>, </span>
<span>    xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span>,<span class="fl">24</span><span class="op">)</span>,</span>
<span>    minxt<span class="op">=</span><span class="fl">0</span>,</span>
<span>    maxxt<span class="op">=</span><span class="fl">24</span>,</span>
<span>    bUseGrouped_xt<span class="op">=</span><span class="fl">1</span>,</span>
<span>    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, mean <span class="op">=</span> <span class="fl">70</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped_db_2</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ev</span><span class="op">$</span><span class="va">ofv</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 42.3</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ev</span><span class="op">$</span><span class="va">rse</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">RSE in %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CL</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">V</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">WT_CL</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">WT_V</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">d_CL</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">d_V</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">sig_prop</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
<p>Here we see that, given this distribution of weights, the covariate
effect parameters (<code>WT_CL</code> and <code>WT_V</code>) would be
well estimated.</p>
<p>However, we are only looking at one sample of 50 individuals. Maybe a
better approach is to look at the distribution of RSEs over a number of
experiments given the expected weight distribution.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">rse_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">poped_db_tmp</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>      ff_fun<span class="op">=</span><span class="va">mod_1</span>,</span>
<span>      fg_fun<span class="op">=</span><span class="va">par_1</span>,</span>
<span>      fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span>
<span>      groupsize<span class="op">=</span><span class="fl">1</span>,</span>
<span>      m<span class="op">=</span><span class="fl">50</span>,</span>
<span>      sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.015</span>,add<span class="op">=</span><span class="fl">0.0015</span><span class="op">)</span>,</span>
<span>      notfixed_sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>      bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">3.8</span>,V<span class="op">=</span><span class="fl">20</span>,WT_CL<span class="op">=</span><span class="fl">0.75</span>,WT_V<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>      d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.05</span>,V<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span>, </span>
<span>      xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">8</span>,<span class="fl">24</span><span class="op">)</span>,</span>
<span>      minxt<span class="op">=</span><span class="fl">0</span>,</span>
<span>      maxxt<span class="op">=</span><span class="fl">24</span>,</span>
<span>      bUseGrouped_xt<span class="op">=</span><span class="fl">1</span>,</span>
<span>      a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>,mean <span class="op">=</span> <span class="fl">70</span>,sd<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">rse_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped_db_tmp</span><span class="op">)</span><span class="op">$</span><span class="va">rse</span></span>
<span>  <span class="va">rse_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">rse_list</span>,<span class="va">rse_tmp</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="op">(</span><span class="va">rse_quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">rse_list</span>,<span class="fl">2</span>,<span class="va">quantile</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">CL</th>
<th align="right">V</th>
<th align="right">WT_CL</th>
<th align="right">WT_V</th>
<th align="right">d_CL</th>
<th align="right">d_V</th>
<th align="right">sig_prop</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0%</td>
<td align="right">3.25</td>
<td align="right">3.32</td>
<td align="right">22.58</td>
<td align="right">17.32</td>
<td align="right">21.02</td>
<td align="right">21.95</td>
<td align="right">10.06</td>
</tr>
<tr class="even">
<td align="left">25%</td>
<td align="right">3.25</td>
<td align="right">3.32</td>
<td align="right">27.10</td>
<td align="right">20.76</td>
<td align="right">21.03</td>
<td align="right">21.95</td>
<td align="right">10.07</td>
</tr>
<tr class="odd">
<td align="left">50%</td>
<td align="right">3.26</td>
<td align="right">3.33</td>
<td align="right">29.06</td>
<td align="right">22.27</td>
<td align="right">21.03</td>
<td align="right">21.96</td>
<td align="right">10.07</td>
</tr>
<tr class="even">
<td align="left">75%</td>
<td align="right">3.32</td>
<td align="right">3.39</td>
<td align="right">31.45</td>
<td align="right">24.10</td>
<td align="right">21.03</td>
<td align="right">21.96</td>
<td align="right">10.07</td>
</tr>
<tr class="odd">
<td align="left">100%</td>
<td align="right">3.43</td>
<td align="right">3.50</td>
<td align="right">40.53</td>
<td align="right">31.05</td>
<td align="right">21.03</td>
<td align="right">21.96</td>
<td align="right">10.07</td>
</tr>
</tbody>
</table>
<p>Note, that the variance of the RSE of the covariate effect is in this
case strongly correlated with the variance of the weight distribution
(not shown).</p>
</div>
<div class="section level2">
<h2 id="model-with-discrete-covariates">Model with discrete covariates<a class="anchor" aria-label="anchor" href="#model-with-discrete-covariates"></a>
</h2>
<p>See <code>ex.11.PK.prior.R</code>. This has the covariate
<code>isPediatric</code> to distinguish between adults and pediatrics.
Alternatively, <code>DOSE</code> and <code>TAU</code> in the first
example can be considered as discrete covariates.</p>
</div>
<div class="section level2">
<h2 id="model-with-inter-occasion-variability-iov">Model with Inter-Occasion Variability (IOV)<a class="anchor" aria-label="anchor" href="#model-with-inter-occasion-variability-iov"></a>
</h2>
<p>The full code for this example is available in
<code>ex.14.PK.IOV.R</code>.</p>
<p>The IOV is introduced with <code>bocc[x,y]</code> in the parameter
definition function as a matrix with the first argument <code>x</code>
indicating the index for the IOV variances, and the second argument
<code>y</code> denoting the occasion. This is used in the example to
derive to different clearance values, i.e., <code>CL_OCC_1</code> and
<code>CL_OCC_2</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sfg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">a</span>,<span class="va">bpop</span>,<span class="va">b</span>,<span class="va">bocc</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">parameters</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> CL_OCC_1<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">bocc</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                CL_OCC_2<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">bocc</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                V<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                KA<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                DOSE<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                TAU<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span> <span class="va">parameters</span> <span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>These parameters can now be used in the model function to define the
change in parameters between the occasions (here the change occurs with
the 7th dose in a one-compartment model with first order
absorption).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html" class="external-link">cppFunction</a></span><span class="op">(</span></span>
<span>  <span class="st">'List one_comp_oral_ode(double Time, NumericVector A, NumericVector Pars) {</span></span>
<span><span class="st">   int n = A.size();</span></span>
<span><span class="st">   NumericVector dA(n);</span></span>
<span><span class="st">            </span></span>
<span><span class="st">   double CL_OCC_1 = Pars[0];</span></span>
<span><span class="st">   double CL_OCC_2 = Pars[1];</span></span>
<span><span class="st">   double V = Pars[2];</span></span>
<span><span class="st">   double KA = Pars[3];</span></span>
<span><span class="st">   double TAU = Pars[4];</span></span>
<span><span class="st">   double N,CL;</span></span>
<span><span class="st">            </span></span>
<span><span class="st">   N = floor(Time/TAU)+1;</span></span>
<span><span class="st">   CL = CL_OCC_1;</span></span>
<span><span class="st">   if(N&gt;6) CL = CL_OCC_2;</span></span>
<span><span class="st">   </span></span>
<span><span class="st">   dA[0] = -KA*A[0];</span></span>
<span><span class="st">   dA[1] = KA*A[0] - (CL/V)*A[1];</span></span>
<span><span class="st">   return List::create(dA);</span></span>
<span><span class="st">   }'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ff.ode.rcpp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>, <span class="va">xt</span>, <span class="va">parameters</span>, <span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="va">A_ini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A1<span class="op">=</span><span class="fl">0</span>, A2<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">times_xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">xt</span><span class="op">)</span> <span class="co">#xt[,,drop=T] </span></span>
<span>    <span class="va">dose_times</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">times_xt</span><span class="op">)</span>,by<span class="op">=</span><span class="va">TAU</span><span class="op">)</span></span>
<span>    <span class="va">eventdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span><span class="op">)</span>, </span>
<span>                           time <span class="op">=</span> <span class="va">dose_times</span>,</span>
<span>                           value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">DOSE</span><span class="op">)</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"add"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">times_xt</span>,<span class="va">dose_times</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span><span class="va">A_ini</span>, <span class="va">times</span>, <span class="va">one_comp_oral_ode</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">CL_OCC_1</span>,<span class="va">CL_OCC_2</span>,<span class="va">V</span>,<span class="va">KA</span>,<span class="va">TAU</span><span class="op">)</span>, </span>
<span>               events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">eventdat</span><span class="op">)</span><span class="op">)</span><span class="co">#atol=1e-13,rtol=1e-13)</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"A2"</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">V</span><span class="op">)</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">times_xt</span>,<span class="va">out</span><span class="op">[</span>,<span class="st">"time"</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">y</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,poped.db<span class="op">=</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The within-subject variability variances (<code>docc</code>) are
defined in the poped database as a 3-column matrix with one row per
IOV-parameter, and the middle column giving the variance values.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>    ff_fun<span class="op">=</span><span class="va">ff.ode.rcpp</span>,</span>
<span>    fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span>
<span>    fg_fun<span class="op">=</span><span class="va">sfg</span>,</span>
<span>    bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">3.75</span>,V<span class="op">=</span><span class="fl">72.8</span>,KA<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>, </span>
<span>    d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.25</span><span class="op">^</span><span class="fl">2</span>,V<span class="op">=</span><span class="fl">0.09</span>,KA<span class="op">=</span><span class="fl">0.09</span><span class="op">)</span>, </span>
<span>    sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.04</span>,add<span class="op">=</span><span class="fl">5e-6</span><span class="op">)</span>,</span>
<span>    notfixed_sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    docc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.09</span>,<span class="fl">0</span><span class="op">)</span>,nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    m<span class="op">=</span><span class="fl">2</span>,</span>
<span>    groupsize<span class="op">=</span><span class="fl">20</span>,</span>
<span>    xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">8</span>,<span class="fl">240</span>,<span class="fl">245</span><span class="op">)</span>,</span>
<span>    minxt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">240</span>,<span class="fl">240</span><span class="op">)</span>,</span>
<span>    maxxt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">248</span>,<span class="fl">248</span><span class="op">)</span>,</span>
<span>    bUseGrouped_xt<span class="op">=</span><span class="fl">1</span>,</span>
<span>    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">20</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">40</span>, TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    maxa<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">200</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,</span>
<span>    mina<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">0</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can visualize the IOV by looking at an example individual. We see
the PK profile changes at the 7th dose (red line) due to the change in
clearance.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span></span>
<span>  <span class="va">poped.db</span>, </span>
<span>  PRED<span class="op">=</span><span class="cn">F</span>,IPRED<span class="op">=</span><span class="cn">F</span>, </span>
<span>  separate.groups<span class="op">=</span><span class="cn">T</span>, </span>
<span>  model_num_points <span class="op">=</span> <span class="fl">300</span>, </span>
<span>  groupsize_sim <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  IPRED.lines <span class="op">=</span> <span class="cn">T</span>, </span>
<span>  alpha.IPRED.lines<span class="op">=</span><span class="fl">0.6</span>,</span>
<span>  sample.times <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">24</span><span class="op">*</span><span class="fl">6</span>,color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="examples_files/figure-html/simulate_IOV_with_IIV-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>We can also see that the design is relatively poor for estimating the
IOV parameter:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ev</span><span class="op">$</span><span class="va">rse</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">RSE in %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CL</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">V</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">KA</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">d_CL</td>
<td align="right">106</td>
</tr>
<tr class="odd">
<td align="left">d_V</td>
<td align="right">43</td>
</tr>
<tr class="even">
<td align="left">d_KA</td>
<td align="right">63</td>
</tr>
<tr class="odd">
<td align="left">D.occ[1,1]</td>
<td align="right">79</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="full-omega-matrix">Full omega matrix<a class="anchor" aria-label="anchor" href="#full-omega-matrix"></a>
</h2>
<p>The full code for this example is available in
<code>ex.15.full.covariance.matrix.R</code>.</p>
<p>The <code>covd</code> object is used for defining the covariances of
the between subject variances (off-diagonal elements of the full
variance-covariance matrix for the between subject variability).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db_with</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>    ff_file<span class="op">=</span><span class="st">"ff"</span>,</span>
<span>    fg_file<span class="op">=</span><span class="st">"sfg"</span>,</span>
<span>    fError_file<span class="op">=</span><span class="st">"feps"</span>,</span>
<span>    bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.15</span>, V<span class="op">=</span><span class="fl">8</span>, KA<span class="op">=</span><span class="fl">1.0</span>, Favail<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>    notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.07</span>, V<span class="op">=</span><span class="fl">0.02</span>, KA<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span>, </span>
<span>    covd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.03</span>,<span class="fl">.1</span>,<span class="fl">.09</span><span class="op">)</span>,</span>
<span>    sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    groupsize<span class="op">=</span><span class="fl">32</span>,</span>
<span>    xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">24</span>,<span class="fl">36</span>,<span class="fl">72</span>,<span class="fl">120</span><span class="op">)</span>,</span>
<span>    minxt<span class="op">=</span><span class="fl">0</span>,</span>
<span>    maxxt<span class="op">=</span><span class="fl">120</span>,</span>
<span>    a<span class="op">=</span><span class="fl">70</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>What do the covariances mean?</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">IIV</span> <span class="op">&lt;-</span> <span class="va">poped.db_with</span><span class="op">$</span><span class="va">parameters</span><span class="op">$</span><span class="va">param.pt.val</span><span class="op">$</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.07 0.03 0.10</span></span>
<span><span class="co">#&gt; [2,] 0.03 0.02 0.09</span></span>
<span><span class="co">#&gt; [3,] 0.10 0.09 0.60</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="va">IIV</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,] 1.0000000 0.8017837 0.4879500</span></span>
<span><span class="co">#&gt; [2,] 0.8017837 1.0000000 0.8215838</span></span>
<span><span class="co">#&gt; [3,] 0.4879500 0.8215838 1.0000000</span></span></code></pre></div>
<p>They indicate a correlation of the inter-individual variabilities,
here of ca. 0.8 between clearance and volume, as well as between volume
and absorption rate.</p>
<p>We can clearly see a difference in the variance of the model
predictions.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped.db</span>, PI<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">12</span><span class="op">)</span> </span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped.db_with</span>,PI<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>,<span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"No covariance in BSV"</span><span class="op">)</span>, <span class="va">p2</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Covariance in BSV"</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="examples_files/figure-html/simulate_with_cov_matrix-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Evaluating the designs with and without the covariances:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">)</span></span>
<span><span class="va">ev2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db_with</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ev1</span><span class="op">$</span><span class="va">rse</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ev2</span><span class="op">$</span><span class="va">rse</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Diagonal BSV</th>
<th align="right">Covariance in BSV</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CL</td>
<td align="right">5</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">V</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">KA</td>
<td align="right">14</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">d_CL</td>
<td align="right">26</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="left">d_V</td>
<td align="right">30</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">d_KA</td>
<td align="right">26</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="left">sig_prop</td>
<td align="right">11</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">D[2,1]</td>
<td align="right">NA</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="left">D[3,1]</td>
<td align="right">NA</td>
<td align="right">41</td>
</tr>
<tr class="even">
<td align="left">D[3,2]</td>
<td align="right">NA</td>
<td align="right">31</td>
</tr>
</tbody>
</table>
<p>Note, that the precision of all other parameters is barely affected
by including the full covariance matrix. This is likely to be different
in practice with more ill-conditioned numerical problems.</p>
<p><strong>Evaluate the same designs with full FIM (instead of
reduced)</strong></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span>, fim.calc.type<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">ev2</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db_with</span>, fim.calc.type<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ev1</span><span class="op">$</span><span class="va">rse</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ev2</span><span class="op">$</span><span class="va">rse</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Diagonal BSV</th>
<th align="right">Covariance in BSV</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CL</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">V</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">KA</td>
<td align="right">5</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">d_CL</td>
<td align="right">26</td>
<td align="right">27</td>
</tr>
<tr class="odd">
<td align="left">d_V</td>
<td align="right">31</td>
<td align="right">31</td>
</tr>
<tr class="even">
<td align="left">d_KA</td>
<td align="right">27</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="left">sig_prop</td>
<td align="right">12</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">D[2,1]</td>
<td align="right">NA</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="left">D[3,1]</td>
<td align="right">NA</td>
<td align="right">42</td>
</tr>
<tr class="even">
<td align="left">D[3,2]</td>
<td align="right">NA</td>
<td align="right">31</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="include-a-prior-fim-compute-power-to-identify-a-parameter">Include a prior FIM, compute power to identify a parameter<a class="anchor" aria-label="anchor" href="#include-a-prior-fim-compute-power-to-identify-a-parameter"></a>
</h2>
<p>In this example we incorporate prior knowledge into a current study
design calculation. First the expected FIM obtained from an experiment
in adults is computed. Then this FIM is added to the current experiment
in children. One could also use the observed FIM when using estimation
software to fit one realization of a design (from the $COVARIANCE step
in NONMEM for example). The full code for this example is available in
<code>ex.11.PK.prior.R</code>.</p>
<p>Note that we define the parameters for a one-compartment first-order
absorption model using a covariate called <code>isPediatric</code> to
switch between adult and pediatric models, and
<code>bpop[5]=pedCL</code> is the factor to multiply the adult clearance
<code>bpop[3]</code> to obtain the pediatric one.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sfg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">a</span>,<span class="va">bpop</span>,<span class="va">b</span>,<span class="va">bocc</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">parameters</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> </span>
<span>    V<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    KA<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    CL<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">bpop</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">^</span><span class="va">a</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="co"># add covariate for pediatrics</span></span>
<span>    Favail<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>    isPediatric <span class="op">=</span> <span class="va">a</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>    DOSE<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    TAU<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span> <span class="va">parameters</span> <span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
<p>The design and design space for adults is defined below (Two arms, 5
sample time points per arm, doses of 20 and 40 mg,
<code>isPediatric = 0</code>). As we want to pool the results (i.e. add
the FIMs together), we also have to provide the <code>pedCL</code>
parameter so that both the adult and children FIMs have the same
dimensions.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>    ff_fun<span class="op">=</span><span class="va">ff.PK.1.comp.oral.md.CL</span>,</span>
<span>    fg_fun<span class="op">=</span><span class="va">sfg</span>,</span>
<span>    fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span>
<span>    bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>V<span class="op">=</span><span class="fl">72.8</span>,KA<span class="op">=</span><span class="fl">0.25</span>,CL<span class="op">=</span><span class="fl">3.75</span>,Favail<span class="op">=</span><span class="fl">0.9</span>,pedCL<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>, </span>
<span>    notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>    d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>V<span class="op">=</span><span class="fl">0.09</span>,KA<span class="op">=</span><span class="fl">0.09</span>,CL<span class="op">=</span><span class="fl">0.25</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>    sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.04</span>,<span class="fl">5e-6</span><span class="op">)</span>,</span>
<span>    notfixed_sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    m<span class="op">=</span><span class="fl">2</span>,</span>
<span>    groupsize<span class="op">=</span><span class="fl">20</span>,</span>
<span>    xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">8</span>,<span class="fl">10</span>,<span class="fl">240</span>,<span class="fl">245</span><span class="op">)</span>,</span>
<span>    bUseGrouped_xt<span class="op">=</span><span class="fl">1</span>,</span>
<span>    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">20</span>,TAU<span class="op">=</span><span class="fl">24</span>,isPediatric <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">40</span>, TAU<span class="op">=</span><span class="fl">24</span>,isPediatric <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Create plot of model without variability</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped.db</span>, model_num_points <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
<p><img src="examples_files/figure-html/simulate_adult-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>To store the FIM from the adult design we evaluate this design</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">outAdult</span> <span class="op">=</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Problems inverting the matrix. Results could be misleading.</span></span>
<span><span class="co">#&gt; Warning:   The following parameters are not estimable:</span></span>
<span><span class="co">#&gt;   pedCL</span></span>
<span><span class="co">#&gt;   Is the design adequate to estimate all parameters?</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] -Inf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                 V          KA          CL pedCL          d_V         d_KA</span></span>
<span><span class="co">#&gt; V      0.05854391   -6.815269 -0.01531146     0    0.0000000   0.00000000</span></span>
<span><span class="co">#&gt; KA    -6.81526942 2963.426688 -1.32113719     0    0.0000000   0.00000000</span></span>
<span><span class="co">#&gt; CL    -0.01531146   -1.321137 37.50597895     0    0.0000000   0.00000000</span></span>
<span><span class="co">#&gt; pedCL  0.00000000    0.000000  0.00000000     0    0.0000000   0.00000000</span></span>
<span><span class="co">#&gt; d_V    0.00000000    0.000000  0.00000000     0 1203.3695137 192.31775149</span></span>
<span><span class="co">#&gt; d_KA   0.00000000    0.000000  0.00000000     0  192.3177515 428.81459138</span></span>
<span><span class="co">#&gt; d_CL   0.00000000    0.000000  0.00000000     0    0.2184104   0.01919009</span></span>
<span><span class="co">#&gt;               d_CL</span></span>
<span><span class="co">#&gt; V     0.000000e+00</span></span>
<span><span class="co">#&gt; KA    0.000000e+00</span></span>
<span><span class="co">#&gt; CL    0.000000e+00</span></span>
<span><span class="co">#&gt; pedCL 0.000000e+00</span></span>
<span><span class="co">#&gt; d_V   2.184104e-01</span></span>
<span><span class="co">#&gt; d_KA  1.919009e-02</span></span>
<span><span class="co">#&gt; d_CL  3.477252e+03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;         V        KA        CL     pedCL       d_V      d_KA      d_CL </span></span>
<span><span class="co">#&gt;  6.634931  8.587203  4.354792        NA 33.243601 55.689432 27.133255</span></span></code></pre></div>
<p>It is obvious that we cannot estimate the pediatric covariate from
adult data only; hence the warning message. You can also note the zeros
in the 4th column and 4th row of the FIM indicating that
<code>pedCL</code> cannot be estimated from the adult data.</p>
<p>We can evaluate the adult design without warning, by setting the
<code>pedCL</code> parameter to be fixed (i.e., not estimated):</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span><span class="va">poped.db</span>, notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] 29.70233</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                V          KA          CL          d_V         d_KA         d_CL</span></span>
<span><span class="co">#&gt; V     0.05854391   -6.815269 -0.01531146    0.0000000   0.00000000 0.000000e+00</span></span>
<span><span class="co">#&gt; KA   -6.81526942 2963.426688 -1.32113719    0.0000000   0.00000000 0.000000e+00</span></span>
<span><span class="co">#&gt; CL   -0.01531146   -1.321137 37.50597895    0.0000000   0.00000000 0.000000e+00</span></span>
<span><span class="co">#&gt; d_V   0.00000000    0.000000  0.00000000 1203.3695137 192.31775149 2.184104e-01</span></span>
<span><span class="co">#&gt; d_KA  0.00000000    0.000000  0.00000000  192.3177515 428.81459138 1.919009e-02</span></span>
<span><span class="co">#&gt; d_CL  0.00000000    0.000000  0.00000000    0.2184104   0.01919009 3.477252e+03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;         V        KA        CL       d_V      d_KA      d_CL </span></span>
<span><span class="co">#&gt;  6.634931  8.587203  4.354792 33.243601 55.689432 27.133255</span></span></code></pre></div>
<p>One obtains good estimates for all parameters for adults (&lt;60% RSE
for all).</p>
<p>For pediatrics the covariate <code>isPediatric = 1</code>. We define
one arm, 4 sample-time points.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db.ped</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>    ff_fun<span class="op">=</span><span class="va">ff.PK.1.comp.oral.md.CL</span>,</span>
<span>    fg_fun<span class="op">=</span><span class="va">sfg</span>,</span>
<span>    fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span>
<span>    bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>V<span class="op">=</span><span class="fl">72.8</span>,KA<span class="op">=</span><span class="fl">0.25</span>,CL<span class="op">=</span><span class="fl">3.75</span>,Favail<span class="op">=</span><span class="fl">0.9</span>,pedCL<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span>, </span>
<span>    notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>    d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>V<span class="op">=</span><span class="fl">0.09</span>,KA<span class="op">=</span><span class="fl">0.09</span>,CL<span class="op">=</span><span class="fl">0.25</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>    sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.04</span>,<span class="fl">5e-6</span><span class="op">)</span>,</span>
<span>    notfixed_sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    m<span class="op">=</span><span class="fl">1</span>,</span>
<span>    groupsize<span class="op">=</span><span class="fl">6</span>,</span>
<span>    xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">240</span><span class="op">)</span>,</span>
<span>    bUseGrouped_xt<span class="op">=</span><span class="fl">1</span>,</span>
<span>    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">40</span>,TAU<span class="op">=</span><span class="fl">24</span>,isPediatric <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We can create a plot of the pediatric model without variability</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped.db.ped</span>, model_num_points <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
<p><img src="examples_files/figure-html/simulate_pediatrics-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Evaluate the design of the pediatrics study alone.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db.ped</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] -15.2274</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                  V         KA          CL        pedCL         d_V       d_KA</span></span>
<span><span class="co">#&gt; V      0.007766643  -1.395981 -0.01126202  -0.05279073   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; KA    -1.395980934 422.458209 -2.14666933 -10.06251250   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; CL    -0.011262023  -2.146669  5.09936874  23.90329099   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; pedCL -0.052790734 -10.062512 23.90329099 112.04667652   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; d_V    0.000000000   0.000000  0.00000000   0.00000000 141.1922923 53.7923483</span></span>
<span><span class="co">#&gt; d_KA   0.000000000   0.000000  0.00000000   0.00000000  53.7923483 58.0960085</span></span>
<span><span class="co">#&gt; d_CL   0.000000000   0.000000  0.00000000   0.00000000   0.7877291  0.3375139</span></span>
<span><span class="co">#&gt;              d_CL</span></span>
<span><span class="co">#&gt; V       0.0000000</span></span>
<span><span class="co">#&gt; KA      0.0000000</span></span>
<span><span class="co">#&gt; CL      0.0000000</span></span>
<span><span class="co">#&gt; pedCL   0.0000000</span></span>
<span><span class="co">#&gt; d_V     0.7877291</span></span>
<span><span class="co">#&gt; d_KA    0.3375139</span></span>
<span><span class="co">#&gt; d_CL  428.5254900</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;            V           KA           CL        pedCL          d_V         d_KA </span></span>
<span><span class="co">#&gt; 2.472122e+01 3.084970e+01 7.414552e+08 7.414552e+08 1.162309e+02 1.811978e+02 </span></span>
<span><span class="co">#&gt;         d_CL </span></span>
<span><span class="co">#&gt; 7.729188e+01</span></span></code></pre></div>
<p>Clearly the design has problems on its own.</p>
<p>We can add the prior information from the adult study and evaluate
that design (i.e., pooling adult and pediatric data).</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>  <span class="va">poped.db.ped</span>,</span>
<span>  prior_fim <span class="op">=</span> <span class="va">outAdult</span><span class="op">$</span><span class="va">fim</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">out.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db.all</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] 34.96368</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                  V         KA          CL        pedCL         d_V       d_KA</span></span>
<span><span class="co">#&gt; V      0.007766643  -1.395981 -0.01126202  -0.05279073   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; KA    -1.395980934 422.458209 -2.14666933 -10.06251250   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; CL    -0.011262023  -2.146669  5.09936874  23.90329099   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; pedCL -0.052790734 -10.062512 23.90329099 112.04667652   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; d_V    0.000000000   0.000000  0.00000000   0.00000000 141.1922923 53.7923483</span></span>
<span><span class="co">#&gt; d_KA   0.000000000   0.000000  0.00000000   0.00000000  53.7923483 58.0960085</span></span>
<span><span class="co">#&gt; d_CL   0.000000000   0.000000  0.00000000   0.00000000   0.7877291  0.3375139</span></span>
<span><span class="co">#&gt;              d_CL</span></span>
<span><span class="co">#&gt; V       0.0000000</span></span>
<span><span class="co">#&gt; KA      0.0000000</span></span>
<span><span class="co">#&gt; CL      0.0000000</span></span>
<span><span class="co">#&gt; pedCL   0.0000000</span></span>
<span><span class="co">#&gt; d_V     0.7877291</span></span>
<span><span class="co">#&gt; d_KA    0.3375139</span></span>
<span><span class="co">#&gt; d_CL  428.5254900</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;         V        KA        CL     pedCL       d_V      d_KA      d_CL </span></span>
<span><span class="co">#&gt;  6.381388  8.222819  4.354761 12.591940 31.808871 52.858399 25.601551</span></span></code></pre></div>
<p>The pooled data leads to much higher precision in parameter estimates
compared to either study separately.</p>
<p>One can also obtain the power for estimating the pediatric difference
in clearance (power in estimating bpop[5] as different from 1).</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evaluate_power.html">evaluate_power</a></span><span class="op">(</span><span class="va">poped.db.all</span>, bpop_idx<span class="op">=</span><span class="fl">5</span>, h0<span class="op">=</span><span class="fl">1</span>, out<span class="op">=</span><span class="va">out.all</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] 34.96368</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                  V         KA          CL        pedCL         d_V       d_KA</span></span>
<span><span class="co">#&gt; V      0.007766643  -1.395981 -0.01126202  -0.05279073   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; KA    -1.395980934 422.458209 -2.14666933 -10.06251250   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; CL    -0.011262023  -2.146669  5.09936874  23.90329099   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; pedCL -0.052790734 -10.062512 23.90329099 112.04667652   0.0000000  0.0000000</span></span>
<span><span class="co">#&gt; d_V    0.000000000   0.000000  0.00000000   0.00000000 141.1922923 53.7923483</span></span>
<span><span class="co">#&gt; d_KA   0.000000000   0.000000  0.00000000   0.00000000  53.7923483 58.0960085</span></span>
<span><span class="co">#&gt; d_CL   0.000000000   0.000000  0.00000000   0.00000000   0.7877291  0.3375139</span></span>
<span><span class="co">#&gt;              d_CL</span></span>
<span><span class="co">#&gt; V       0.0000000</span></span>
<span><span class="co">#&gt; KA      0.0000000</span></span>
<span><span class="co">#&gt; CL      0.0000000</span></span>
<span><span class="co">#&gt; pedCL   0.0000000</span></span>
<span><span class="co">#&gt; d_V     0.7877291</span></span>
<span><span class="co">#&gt; d_KA    0.3375139</span></span>
<span><span class="co">#&gt; d_CL  428.5254900</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;         V        KA        CL     pedCL       d_V      d_KA      d_CL </span></span>
<span><span class="co">#&gt;  6.381388  8.222819  4.354761 12.591940 31.808871 52.858399 25.601551 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $power</span></span>
<span><span class="co">#&gt;       Value      RSE power_pred power_want need_rse min_N_tot</span></span>
<span><span class="co">#&gt; pedCL   0.8 12.59194   51.01851         80 8.923519        14</span></span></code></pre></div>
<p>We see that to clearly distinguish this parameter one would need 14
children in the pediatric study (for 80% power at <span class="math inline">\(\alpha=0.05\)</span>).</p>
</div>
<div class="section level2">
<h2 id="design-evaluation-including-uncertainty-in-the-model-parameters-robust-design">Design evaluation including uncertainty in the model parameters
(robust design)<a class="anchor" aria-label="anchor" href="#design-evaluation-including-uncertainty-in-the-model-parameters-robust-design"></a>
</h2>
<p>In this example the aim is to evaluate a design incorporating
uncertainty around parameter values in the model. The full code for this
example is available in <code>ex.2.d.warfarin.ED.R</code>. This
illustration is one of the Warfarin examples from software comparison
in: Nyberg et al.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Nyberg, J., Bazzoli, C., Ogungbenro, K., Aliev, A.,
Leonov, S., Duffull, S., Hooker, A.C. and Mentré, F. (2014). Methods and
software tools for design evaluation for population
pharmacokinetics-pharmacodynamics studies. British Journal of Clinical
Pharmacology, 79(1), 1–32. &lt;a href="https://doi.org/10.1111/bcp.12352" class="external-link uri"&gt;https://doi.org/10.1111/bcp.12352&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a>.</p>
<p>We define the fixed effects in the model and add a 10% uncertainty to
all but Favail. To do this we use a<br>
Matrix defining the fixed effects, per row (row number =
parameter_number) we should have:</p>
<ul>
<li>column 1 the type of the distribution for E-family designs (0 =
Fixed, 1 = Normal, 2 = Uniform, 3 = User Defined Distribution, 4 =
lognormal and 5 = truncated normal)</li>
<li>column 2 defines the mean.</li>
<li>column 3 defines the variance of the distribution (or length of
uniform distribution).</li>
</ul>
<p>Here we define a log-normal distribution</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bpop_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.15</span>, V<span class="op">=</span><span class="fl">8</span>, KA<span class="op">=</span><span class="fl">1.0</span>, Favail<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">bpop_vals_ed</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/ones.html">ones</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bpop_vals</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">4</span>, <span class="co"># log-normal distribution</span></span>
<span>        <span class="va">bpop_vals</span>,</span>
<span>        <span class="fu"><a href="../reference/ones.html">ones</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bpop_vals</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">bpop_vals</span><span class="op">*</span><span class="fl">0.1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="co"># 10% of bpop value</span></span>
<span><span class="va">bpop_vals_ed</span><span class="op">[</span><span class="st">"Favail"</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">bpop_vals_ed</span></span>
<span><span class="co">#&gt;          bpop_vals         </span></span>
<span><span class="co">#&gt; CL     4      0.15 0.000225</span></span>
<span><span class="co">#&gt; V      4      8.00 0.640000</span></span>
<span><span class="co">#&gt; KA     4      1.00 0.010000</span></span>
<span><span class="co">#&gt; Favail 0      1.00 0.000000</span></span></code></pre></div>
<p>With this model and parameter set we define the initial design and
design space. Specifically note the <code>bpop=bpop_vals_ed</code> and
the <code>ED_samp_size=20</code> arguments. <code>ED_samp_size=20</code>
indicates the number of samples used in evaluating the E-family
objective functions.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>    ff_fun<span class="op">=</span><span class="va">ff</span>,</span>
<span>    fg_fun<span class="op">=</span><span class="va">sfg</span>,</span>
<span>    fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span>
<span>    bpop<span class="op">=</span><span class="va">bpop_vals_ed</span>, </span>
<span>    notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.07</span>, V<span class="op">=</span><span class="fl">0.02</span>, KA<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span>, </span>
<span>    sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    groupsize<span class="op">=</span><span class="fl">32</span>,</span>
<span>    xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">24</span>,<span class="fl">36</span>,<span class="fl">72</span>,<span class="fl">120</span><span class="op">)</span>,</span>
<span>    minxt<span class="op">=</span><span class="fl">0</span>,</span>
<span>    maxxt<span class="op">=</span><span class="fl">120</span>,</span>
<span>    a<span class="op">=</span><span class="fl">70</span>,</span>
<span>    mina<span class="op">=</span><span class="fl">0</span>,</span>
<span>    maxa<span class="op">=</span><span class="fl">100</span>,</span>
<span>    ED_samp_size<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>You can also provide <code>ED_samp_size</code> argument to the design
evaluation or optimization arguments:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>;<span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span>,d_switch<span class="op">=</span><span class="cn">FALSE</span>,ED_samp_size<span class="op">=</span><span class="fl">20</span><span class="op">)</span>; <span class="fu"><a href="../reference/toc.html">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] 55.41311</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                     CL         V        KA         d_CL         d_V        d_KA</span></span>
<span><span class="co">#&gt; CL         17590.84071 21.130793 10.320177 0.000000e+00     0.00000  0.00000000</span></span>
<span><span class="co">#&gt; V             21.13079 17.817120 -3.529007 0.000000e+00     0.00000  0.00000000</span></span>
<span><span class="co">#&gt; KA            10.32018 -3.529007 51.622520 0.000000e+00     0.00000  0.00000000</span></span>
<span><span class="co">#&gt; d_CL           0.00000  0.000000  0.000000 2.319890e+03    10.62595  0.03827253</span></span>
<span><span class="co">#&gt; d_V            0.00000  0.000000  0.000000 1.062595e+01 19005.72029 11.80346662</span></span>
<span><span class="co">#&gt; d_KA           0.00000  0.000000  0.000000 3.827253e-02    11.80347 38.83793850</span></span>
<span><span class="co">#&gt; SIGMA[1,1]     0.00000  0.000000  0.000000 7.336186e+02  9690.93156 64.79341332</span></span>
<span><span class="co">#&gt; SIGMA[2,2]     0.00000  0.000000  0.000000 9.057819e+01   265.70389  2.95284399</span></span>
<span><span class="co">#&gt;              SIGMA[1,1]  SIGMA[2,2]</span></span>
<span><span class="co">#&gt; CL              0.00000    0.000000</span></span>
<span><span class="co">#&gt; V               0.00000    0.000000</span></span>
<span><span class="co">#&gt; KA              0.00000    0.000000</span></span>
<span><span class="co">#&gt; d_CL          733.61860   90.578191</span></span>
<span><span class="co">#&gt; d_V          9690.93156  265.703890</span></span>
<span><span class="co">#&gt; d_KA           64.79341    2.952844</span></span>
<span><span class="co">#&gt; SIGMA[1,1] 193719.81023 6622.636801</span></span>
<span><span class="co">#&gt; SIGMA[2,2]   6622.63680  477.649386</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;         CL          V         KA       d_CL        d_V       d_KA SIGMA[1,1] </span></span>
<span><span class="co">#&gt;   5.030673   2.983917  14.014958  29.787587  36.758952  26.753311  31.645011 </span></span>
<span><span class="co">#&gt; SIGMA[2,2] </span></span>
<span><span class="co">#&gt;  25.341368</span></span>
<span><span class="co">#&gt; Elapsed time: 0.142 seconds.</span></span></code></pre></div>
<p>We can see that the result, based on MC sampling, is somewhat
variable with so few samples.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tic.html">tic</a></span><span class="op">(</span><span class="op">)</span>;<span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span>,d_switch<span class="op">=</span><span class="cn">FALSE</span>,ED_samp_size<span class="op">=</span><span class="fl">20</span><span class="op">)</span>; <span class="fu"><a href="../reference/toc.html">toc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] 55.42045</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                     CL         V        KA         d_CL         d_V        d_KA</span></span>
<span><span class="co">#&gt; CL         17652.97859 20.900077 10.206898 0.000000e+00     0.00000  0.00000000</span></span>
<span><span class="co">#&gt; V             20.90008 17.846603 -3.482767 0.000000e+00     0.00000  0.00000000</span></span>
<span><span class="co">#&gt; KA            10.20690 -3.482767 51.214965 0.000000e+00     0.00000  0.00000000</span></span>
<span><span class="co">#&gt; d_CL           0.00000  0.000000  0.000000 2.323385e+03    10.26722  0.03682497</span></span>
<span><span class="co">#&gt; d_V            0.00000  0.000000  0.000000 1.026722e+01 19067.54099 11.76757081</span></span>
<span><span class="co">#&gt; d_KA           0.00000  0.000000  0.000000 3.682497e-02    11.76757 38.83554961</span></span>
<span><span class="co">#&gt; SIGMA[1,1]     0.00000  0.000000  0.000000 7.287665e+02  9671.83881 65.02022679</span></span>
<span><span class="co">#&gt; SIGMA[2,2]     0.00000  0.000000  0.000000 9.042351e+01   265.46887  2.94967457</span></span>
<span><span class="co">#&gt;              SIGMA[1,1]  SIGMA[2,2]</span></span>
<span><span class="co">#&gt; CL              0.00000    0.000000</span></span>
<span><span class="co">#&gt; V               0.00000    0.000000</span></span>
<span><span class="co">#&gt; KA              0.00000    0.000000</span></span>
<span><span class="co">#&gt; d_CL          728.76653   90.423509</span></span>
<span><span class="co">#&gt; d_V          9671.83881  265.468868</span></span>
<span><span class="co">#&gt; d_KA           65.02023    2.949675</span></span>
<span><span class="co">#&gt; SIGMA[1,1] 194823.12196 6613.513007</span></span>
<span><span class="co">#&gt; SIGMA[2,2]   6613.51301  476.316709</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;         CL          V         KA       d_CL        d_V       d_KA SIGMA[1,1] </span></span>
<span><span class="co">#&gt;   5.021700   2.980981  14.068646  29.765030  36.691675  26.754137  31.469425 </span></span>
<span><span class="co">#&gt; SIGMA[2,2] </span></span>
<span><span class="co">#&gt;  25.311870</span></span>
<span><span class="co">#&gt; Elapsed time: 0.135 seconds.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="design-evaluation-for-a-subset-of-model-parameters-of-interest-ds-optimality">Design evaluation for a subset of model parameters of interest (Ds
optimality)<a class="anchor" aria-label="anchor" href="#design-evaluation-for-a-subset-of-model-parameters-of-interest-ds-optimality"></a>
</h2>
<p>Ds-optimality is a criterion that can be used if one is interested in
estimating a subset “s” of the model parameters as precisely as
possible. The full code for this example is available in
<code>ex.2.e.warfarin.Ds.R</code>. First we define initial design and
design space:</p>
<p>For Ds optimality we add the <code>ds_index</code> option to the
<code>create.poped.database</code> function to indicate whether a
parameter is interesting (=0) or not (=1). Moreover, we set the
<code>ofv_calc_type=6</code> for computing the Ds optimality criterion
(it is set to 4 by default, for computing the log of the determinant of
the FIM). More details are available by running the command
<code><a href="../reference/create.poped.database.html">?create.poped.database</a></code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>    ff_fun<span class="op">=</span><span class="va">ff</span>,</span>
<span>    fg_fun<span class="op">=</span><span class="va">sfg</span>,</span>
<span>    fError_fun<span class="op">=</span><span class="va">feps.add.prop</span>,</span>
<span>    bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.15</span>, V<span class="op">=</span><span class="fl">8</span>, KA<span class="op">=</span><span class="fl">1.0</span>, Favail<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>    notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>CL<span class="op">=</span><span class="fl">0.07</span>, V<span class="op">=</span><span class="fl">0.02</span>, KA<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span>, </span>
<span>    sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    groupsize<span class="op">=</span><span class="fl">32</span>,</span>
<span>    xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">24</span>,<span class="fl">36</span>,<span class="fl">72</span>,<span class="fl">120</span><span class="op">)</span>,</span>
<span>    minxt<span class="op">=</span><span class="fl">0</span>,</span>
<span>    maxxt<span class="op">=</span><span class="fl">120</span>,</span>
<span>    a<span class="op">=</span><span class="fl">70</span>,</span>
<span>    mina<span class="op">=</span><span class="fl">0</span>,</span>
<span>    maxa<span class="op">=</span><span class="fl">100</span>,</span>
<span>    ds_index<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="co"># size is number_of_non_fixed_parameters</span></span>
<span>    ofv_calc_type<span class="op">=</span><span class="fl">6</span><span class="op">)</span> <span class="co"># Ds OFV calculation</span></span></code></pre></div>
<p>Design evaluation:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] 16.49204</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                     CL         V        KA         d_CL          d_V</span></span>
<span><span class="co">#&gt; CL         17141.83891 20.838375 10.011000 0.000000e+00     0.000000</span></span>
<span><span class="co">#&gt; V             20.83837 17.268051 -3.423641 0.000000e+00     0.000000</span></span>
<span><span class="co">#&gt; KA            10.01100 -3.423641 49.864697 0.000000e+00     0.000000</span></span>
<span><span class="co">#&gt; d_CL           0.00000  0.000000  0.000000 2.324341e+03     9.770352</span></span>
<span><span class="co">#&gt; d_V            0.00000  0.000000  0.000000 9.770352e+00 19083.877564</span></span>
<span><span class="co">#&gt; d_KA           0.00000  0.000000  0.000000 3.523364e-02    11.721317</span></span>
<span><span class="co">#&gt; SIGMA[1,1]     0.00000  0.000000  0.000000 7.268410e+02  9656.158553</span></span>
<span><span class="co">#&gt; SIGMA[2,2]     0.00000  0.000000  0.000000 9.062739e+01   266.487127</span></span>
<span><span class="co">#&gt;                   d_KA   SIGMA[1,1]  SIGMA[2,2]</span></span>
<span><span class="co">#&gt; CL          0.00000000      0.00000    0.000000</span></span>
<span><span class="co">#&gt; V           0.00000000      0.00000    0.000000</span></span>
<span><span class="co">#&gt; KA          0.00000000      0.00000    0.000000</span></span>
<span><span class="co">#&gt; d_CL        0.03523364    726.84097   90.627386</span></span>
<span><span class="co">#&gt; d_V        11.72131703   9656.15855  266.487127</span></span>
<span><span class="co">#&gt; d_KA       38.85137516     64.78096    2.947285</span></span>
<span><span class="co">#&gt; SIGMA[1,1] 64.78095548 192840.20092 6659.569867</span></span>
<span><span class="co">#&gt; SIGMA[2,2]  2.94728469   6659.56987  475.500111</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;         CL          V         KA       d_CL        d_V       d_KA SIGMA[1,1] </span></span>
<span><span class="co">#&gt;   5.096246   3.031164  14.260384  29.761226  36.681388  26.748640  32.011719 </span></span>
<span><span class="co">#&gt; SIGMA[2,2] </span></span>
<span><span class="co">#&gt;  25.637971</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="shrinkage">Shrinkage<a class="anchor" aria-label="anchor" href="#shrinkage"></a>
</h2>
<p>The full code for this example is available in
“ex.13.shrinkage.R”.</p>
<p><img src="examples_files/figure-html/unnamed-chunk-61-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>To evaluate the estimation quality of the individual random effects
in the model (the b’s) we use the function <code><a href="../reference/shrinkage.html">shrinkage()</a></code>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/shrinkage.html">shrinkage</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;    d_KA   d_V `D[3,3]` type       group</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0.504 0.367    0.424 shrink_var grp_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0.295 0.205    0.241 shrink_sd  grp_1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0.710 0.303    0.206 se         grp_1</span></span></code></pre></div>
<p>The output shows us the expected shrinkage on the variance scale
(<span class="math inline">\(shrink_{var}=1-var(b_j)/D(j,j)\)</span>)
and on the standard deviation scale (<span class="math inline">\(shrink_{sd}=1-sd(b_j)/sqrt(D(j,j))\)</span>), as
well as the standard errors of the <span class="math inline">\(b_j\)</span> estimates.</p>
</div>
<div class="section level2">
<h2 id="further-examples">Further examples<a class="anchor" aria-label="anchor" href="#further-examples"></a>
</h2>
<p>Available in PopED, but not shown in examples:</p>
<ul>
<li>Espresso design</li>
<li>Handling BLQ data<br>
</li>
<li>Irregular dosing more complex: e.g. switching between s.c. and i.v.
within one arm.</li>
<li>Constraining the optimization to different allowed sampling times
for each group<br>
</li>
<li>Constraining the optimization to different allowed sampling times
for each response</li>
<li>Keep some sampling time fixed (they will be automatically part of
the optimal design protocol)<br>
</li>
<li>Handling derived outputs</li>
</ul>
<p>To be implemented:</p>
<ul>
<li>Symbolic differentiation</li>
</ul>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://katalog.uu.se/profile/?id=N4-631" class="external-link">Andrew C. Hooker</a>, Marco Foracchia, <a href="https://katalog.uu.se/profile/?id=N9-467" class="external-link">Sebastian Ueckert</a>, <a href="https://scholar.google.se/citations?user=4CgHwr0AAAAJ&amp;hl=en" class="external-link">Joakim Nyberg</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
