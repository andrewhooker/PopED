<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to PopED • PopED</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to PopED">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PopED</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.6.0.9005</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Go to homepage"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/intro-poped.html">Introduction</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/examples.html">Examples</a></li>
    <li><a class="dropdown-item" href="../articles/model_def_other_pkgs.html">Defining models for PopED using R based PKPD simulators</a></li>
    <li><a class="dropdown-item" href="../articles/handling_LOQ.html">Optimal design with LOQ data in PopED</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/andrewhooker/PopED" aria-label="Go to github for PopED"><span class="fa fab fa-github fa-lg"></span> Source</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to PopED</h1>
                        <h4 data-toc-skip class="author">Andrew
Hooker</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/andrewhooker/PopED/blob/master/vignettes/intro-poped.Rmd" class="external-link"><code>vignettes/intro-poped.Rmd</code></a></small>
      <div class="d-none name"><code>intro-poped.Rmd</code></div>
    </div>

    
    
<p>PopED computes optimal experimental designs for both population and
individual studies based on nonlinear mixed-effect models. Often this is
based on a computation of the Fisher Information Matrix (FIM).</p>
<p>To get started you need to define</p>
<ul>
<li>A model.</li>
<li>An initial design (and design space if you want to optimize)</li>
<li>The tasks to perform.</li>
</ul>
<p>There are a number of functions to help you with these tasks. See
<code>?poped</code> for more information.</p>
<p>Below is an example to introduce the package. Several other examples
are available as r-scripts in the “examples” folder in the PopED
installation directory located at:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, package<span class="op">=</span><span class="st">"PopED"</span><span class="op">)</span></span></code></pre></div>
<p>You can view a list of the example files using the commands:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, package<span class="op">=</span><span class="st">"PopED"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">ex_dir</span><span class="op">)</span></span></code></pre></div>
<p>You can then open one of the examples (for example,
<code>ex.1.a.PK.1.comp.oral.md.intro.R</code>, is very similar to the
code found in this vignette) using the following code</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_name</span> <span class="op">&lt;-</span> <span class="st">"ex.1.a.PK.1.comp.oral.md.intro.R"</span></span>
<span><span class="va">ex_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>,<span class="va">file_name</span>,package<span class="op">=</span><span class="st">"PopED"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">ex_file</span>,<span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,overwrite <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/file.edit.html" class="external-link">file.edit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="va">file_name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In addition, there is another vignette called “Examples” that
explores the new features in each example.</p>
<div class="section level2">
<h2 id="define-a-model">Define a model<a class="anchor" aria-label="anchor" href="#define-a-model"></a>
</h2>
<p>Here we define a one-compartment pharmacokinetic model with linear
absorption using an analytical solution. In this case the solution is
applicable for both multiple and single dosing. Note that this function
is also predefined in PopED as <code>ff.PK.1.comp.oral.md.CL</code> (see
<code><a href="../reference/ff.PK.1.comp.oral.md.CL.html">?ff.PK.1.comp.oral.md.CL</a></code> for more information).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrewhooker.github.io/PopED/">PopED</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"PopED"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '0.6.0.9005'</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>,<span class="va">xt</span>,<span class="va">parameters</span>,<span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">)</span>,<span class="op">{</span></span>
<span>    <span class="va">N</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">xt</span><span class="op">/</span><span class="va">TAU</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span></span>
<span>    <span class="va">f</span><span class="op">=</span><span class="op">(</span><span class="va">DOSE</span><span class="op">*</span><span class="va">Favail</span><span class="op">/</span><span class="va">V</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">KA</span><span class="op">/</span><span class="op">(</span><span class="va">KA</span> <span class="op">-</span> <span class="va">CL</span><span class="op">/</span><span class="va">V</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> </span>
<span>      <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">CL</span><span class="op">/</span><span class="va">V</span> <span class="op">*</span> <span class="op">(</span><span class="va">xt</span> <span class="op">-</span> <span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">TAU</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span> <span class="op">*</span> <span class="va">CL</span><span class="op">/</span><span class="va">V</span> <span class="op">*</span> <span class="va">TAU</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">CL</span><span class="op">/</span><span class="va">V</span> <span class="op">*</span> <span class="va">TAU</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> </span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">KA</span> <span class="op">*</span> <span class="op">(</span><span class="va">xt</span> <span class="op">-</span> <span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">TAU</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span> <span class="op">*</span> <span class="va">KA</span> <span class="op">*</span> <span class="va">TAU</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">KA</span> <span class="op">*</span> <span class="va">TAU</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> f<span class="op">=</span><span class="va">f</span>,poped.db<span class="op">=</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next we define the parameters of this function, in this case the
between-subject variability (BSV) for each parameter is log-normally
distributed (parameter <code>Favail</code> is assumed not to have BSV).
<code>DOSE</code> and <code>TAU</code> are defined as covariates (in
vector <code>a</code>) so that we can optimize their values later.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sfg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">a</span>,<span class="va">bpop</span>,<span class="va">b</span>,<span class="va">bocc</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">parameters</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> V<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                KA<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                CL<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                Favail<span class="op">=</span><span class="va">bpop</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>                DOSE<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                TAU<span class="op">=</span><span class="va">a</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we define the residual unexplained variability (RUV) function, in
this case the RUV has both an additive and proportional component.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_switch</span>,<span class="va">xt</span>,<span class="va">parameters</span>,<span class="va">epsi</span>,<span class="va">poped.db</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">returnArgs</span> <span class="op">&lt;-</span> <span class="fu">ff</span><span class="op">(</span><span class="va">model_switch</span>,<span class="va">xt</span>,<span class="va">parameters</span>,<span class="va">poped.db</span><span class="op">)</span> </span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="va">returnArgs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">poped.db</span> <span class="op">&lt;-</span> <span class="va">returnArgs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span> </span>
<span>  <span class="va">y</span> <span class="op">=</span> <span class="va">f</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">epsi</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="va">epsi</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,poped.db<span class="op">=</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-poped-database">Create a PopED database<a class="anchor" aria-label="anchor" href="#create-a-poped-database"></a>
</h2>
<p>We create a poped database to link the model defined above with a set
of model parameters, the initial design and design space for
optimization.</p>
<p>In this example, the parameter values are defined for the fixed
effects (<code>bpop</code>), the between-subject variability variances
(<code>d</code>) and the residual variability variances
(<code>sigma</code>). We also fix the parameter <code>Favail</code>
using <code>notfixed_bpop</code>, since we have only oral dosing and the
parameter is not identifiable. Fixing a parameter means that we assume
the parameter will not be estimated (and is know without uncertainty).
In addition, we fix the small additive RUV term, as this term is
reflecting the higher error expected at low concentration measurements
(limit of quantification measurements) and would typically be calculated
from analytical assay methods (for example, the standard deviation of
the parameter might be 20% of the limit of quantification).</p>
<p>For the initial design, we define two groups (<code>m=2</code>) of 20
individuals (<code>groupsize=20</code>), with doses of 20 mg or 40 mg
every 24 hours (<code>a</code>). The initial design has 5 sample times
per individual (<code>xt</code>).</p>
<p>For the design space, which can be searched during optimization, we
define a potential dose range of between 0 and 200 mg (<code>mina</code>
and <code>maxa</code>), and a range of potential sample times between 0
and 10 hours for the first three samples and between 240 and 248 hours
for the last two samples (<code>minxt</code> and <code>maxxt</code>).
Finally, we fix the two groups of subjects to have the same sample times
(<code>bUseGrouped_xt=TRUE</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>  <span class="co"># Model</span></span>
<span>  ff_fun<span class="op">=</span><span class="va">ff</span>,</span>
<span>  fg_fun<span class="op">=</span><span class="va">sfg</span>,</span>
<span>  fError_fun<span class="op">=</span><span class="va">feps</span>,</span>
<span>  bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>V<span class="op">=</span><span class="fl">72.8</span>,KA<span class="op">=</span><span class="fl">0.25</span>,CL<span class="op">=</span><span class="fl">3.75</span>,Favail<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>, </span>
<span>  notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>  d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>V<span class="op">=</span><span class="fl">0.09</span>,KA<span class="op">=</span><span class="fl">0.09</span>,CL<span class="op">=</span><span class="fl">0.25</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>  sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.04</span>,add<span class="op">=</span><span class="fl">5e-6</span><span class="op">)</span>,</span>
<span>  notfixed_sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Design</span></span>
<span>  m<span class="op">=</span><span class="fl">2</span>,</span>
<span>  groupsize<span class="op">=</span><span class="fl">20</span>,</span>
<span>  a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">20</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">40</span>, TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  maxa<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">200</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,</span>
<span>  mina<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">0</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,</span>
<span>  xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">8</span>,<span class="fl">240</span>,<span class="fl">245</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Design space</span></span>
<span>  minxt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">240</span>,<span class="fl">240</span><span class="op">)</span>,</span>
<span>  maxxt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">248</span>,<span class="fl">248</span><span class="op">)</span>,</span>
<span>  bUseGrouped_xt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="design-simulation">Design simulation<a class="anchor" aria-label="anchor" href="#design-simulation"></a>
</h2>
<p>First it may make sense to check your model and design to make sure
you get what you expect when simulating data. Here we plot the model
typical values:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped.db</span>, model_num_points <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-poped_files/figure-html/simulate_without_BSV-1.png" width="700"></p>
<p>Next, we plot the expected prediction interval (by default a 95% PI)
of the data taking into account the BSV and RUV using the option
<code>PI=TRUE</code>. This option makes predictions based on first-order
approximations to the model variance and a normality assumption of that
variance. Better (and slower) computations are possible with the
<code>DV=T</code>, <code>IPRED=T</code> and
<code>groupsize_sim = some large number</code> options.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">poped.db</span>, </span>
<span>                      PI<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                      separate.groups<span class="op">=</span><span class="cn">T</span>, </span>
<span>                      model_num_points <span class="op">=</span> <span class="fl">300</span>, </span>
<span>                      sample.times <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-poped_files/figure-html/simulate_with_BSV-1.png" width="700"></p>
<p>We can get these predictions numerically as well:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span><span class="op">(</span><span class="va">poped.db</span>,DV<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span>,n<span class="op">=</span><span class="fl">5</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">dat</span>,n<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ID Time         DV      IPRED       PRED Group Model DOSE TAU</span></span>
<span><span class="co">#&gt; 1  1    1 0.09659927 0.08034839 0.05325024     1     1   20  24</span></span>
<span><span class="co">#&gt; 2  1    2 0.13172074 0.13415072 0.09204804     1     1   20  24</span></span>
<span><span class="co">#&gt; 3  1    8 0.19502544 0.19134279 0.16409609     1     1   20  24</span></span>
<span><span class="co">#&gt; 4  1  240 0.04847782 0.05881203 0.12671376     1     1   20  24</span></span>
<span><span class="co">#&gt; 5  1  245 0.29770447 0.23457544 0.24980320     1     1   20  24</span></span>
<span><span class="co">#&gt;     ID Time         DV     IPRED      PRED Group Model DOSE TAU</span></span>
<span><span class="co">#&gt; 196 40    1 0.04411438 0.0583122 0.1065005     2     1   40  24</span></span>
<span><span class="co">#&gt; 197 40    2 0.10599655 0.1039377 0.1840961     2     1   40  24</span></span>
<span><span class="co">#&gt; 198 40    8 0.20262746 0.2206604 0.3281922     2     1   40  24</span></span>
<span><span class="co">#&gt; 199 40  240 0.17506051 0.3788561 0.2534275     2     1   40  24</span></span>
<span><span class="co">#&gt; 200 40  245 0.56558539 0.5183551 0.4996064     2     1   40  24</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="design-evaluation">Design evaluation<a class="anchor" aria-label="anchor" href="#design-evaluation"></a>
</h2>
<p>Next, we evaluate the initial design</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">ds1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] 39.309</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                    V          KA           CL        d_V       d_KA        d_CL</span></span>
<span><span class="co">#&gt; V         0.05336692   -8.683963  -0.05863412   0.000000   0.000000    0.000000</span></span>
<span><span class="co">#&gt; KA       -8.68396266 2999.851007 -14.43058560   0.000000   0.000000    0.000000</span></span>
<span><span class="co">#&gt; CL       -0.05863412  -14.430586  37.15243290   0.000000   0.000000    0.000000</span></span>
<span><span class="co">#&gt; d_V       0.00000000    0.000000   0.00000000 999.953587 312.240246    3.202847</span></span>
<span><span class="co">#&gt; d_KA      0.00000000    0.000000   0.00000000 312.240246 439.412556    2.287838</span></span>
<span><span class="co">#&gt; d_CL      0.00000000    0.000000   0.00000000   3.202847   2.287838 3412.005199</span></span>
<span><span class="co">#&gt; sig_prop  0.00000000    0.000000   0.00000000 575.347261 638.581909 1182.325475</span></span>
<span><span class="co">#&gt;            sig_prop</span></span>
<span><span class="co">#&gt; V            0.0000</span></span>
<span><span class="co">#&gt; KA           0.0000</span></span>
<span><span class="co">#&gt; CL           0.0000</span></span>
<span><span class="co">#&gt; d_V        575.3473</span></span>
<span><span class="co">#&gt; d_KA       638.5819</span></span>
<span><span class="co">#&gt; d_CL      1182.3255</span></span>
<span><span class="co">#&gt; sig_prop 33864.3226</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;         V        KA        CL       d_V      d_KA      d_CL  sig_prop </span></span>
<span><span class="co">#&gt;  8.215338 10.090955  4.400304 39.844763 60.655110 27.562541 13.865357</span></span></code></pre></div>
<p>We see that the fixed-effect and residual variability parameters are
relatively well estimated with this design, but the between-subject
variability parameters are less well estimated.</p>
<div class="section level3">
<h3 id="evaluate-alternative-design">Evaluate alternative design<a class="anchor" aria-label="anchor" href="#evaluate-alternative-design"></a>
</h3>
<p>What about an alternative design with sparse sampling? For example,
what if each individual only has 3 time points at 1, 2 and 245
hours:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db.new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span></span>
<span>  <span class="co"># Model</span></span>
<span>  ff_fun<span class="op">=</span><span class="va">ff</span>,</span>
<span>  fg_fun<span class="op">=</span><span class="va">sfg</span>,</span>
<span>  fError_fun<span class="op">=</span><span class="va">feps</span>,</span>
<span>  bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>V<span class="op">=</span><span class="fl">72.8</span>,KA<span class="op">=</span><span class="fl">0.25</span>,CL<span class="op">=</span><span class="fl">3.75</span>,Favail<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>, </span>
<span>  notfixed_bpop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>  d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>V<span class="op">=</span><span class="fl">0.09</span>,KA<span class="op">=</span><span class="fl">0.09</span>,CL<span class="op">=</span><span class="fl">0.25</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>  sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>prop<span class="op">=</span><span class="fl">0.04</span>,add<span class="op">=</span><span class="fl">5e-6</span><span class="op">)</span>,</span>
<span>  notfixed_sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># Design</span></span>
<span>  m<span class="op">=</span><span class="fl">2</span>,</span>
<span>  groupsize<span class="op">=</span><span class="fl">20</span>,</span>
<span>  a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">20</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">40</span>, TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  maxa<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">200</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,</span>
<span>  mina<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DOSE<span class="op">=</span><span class="fl">0</span>,TAU<span class="op">=</span><span class="fl">24</span><span class="op">)</span>,</span>
<span>  xt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">245</span><span class="op">)</span>,</span>
<span>                                      </span>
<span>  <span class="co"># Design space</span></span>
<span>  minxt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">240</span><span class="op">)</span>,</span>
<span>  maxxt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">248</span><span class="op">)</span>,</span>
<span>  bUseGrouped_xt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">ds2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_design.html">evaluate_design</a></span><span class="op">(</span><span class="va">poped.db.new</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ofv</span></span>
<span><span class="co">#&gt; [1] 29.66484</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fim</span></span>
<span><span class="co">#&gt;                     V         KA           CL        d_V       d_KA        d_CL</span></span>
<span><span class="co">#&gt; V          0.04243232  -10.51432   0.05782431   0.000000   0.000000    0.000000</span></span>
<span><span class="co">#&gt; KA       -10.51432135 2666.25466 -14.66678102   0.000000   0.000000    0.000000</span></span>
<span><span class="co">#&gt; CL         0.05782431  -14.66678  21.59743298   0.000000   0.000000    0.000000</span></span>
<span><span class="co">#&gt; d_V        0.00000000    0.00000   0.00000000 632.163776 457.737062    3.115099</span></span>
<span><span class="co">#&gt; d_KA       0.00000000    0.00000   0.00000000 457.737062 347.115999    2.363458</span></span>
<span><span class="co">#&gt; d_CL       0.00000000    0.00000   0.00000000   3.115099   2.363458 1153.026981</span></span>
<span><span class="co">#&gt; sig_prop   0.00000000    0.00000   0.00000000 348.477101 262.369792 1979.231386</span></span>
<span><span class="co">#&gt;            sig_prop</span></span>
<span><span class="co">#&gt; V            0.0000</span></span>
<span><span class="co">#&gt; KA           0.0000</span></span>
<span><span class="co">#&gt; CL           0.0000</span></span>
<span><span class="co">#&gt; d_V        348.4771</span></span>
<span><span class="co">#&gt; d_KA       262.3698</span></span>
<span><span class="co">#&gt; d_CL      1979.2314</span></span>
<span><span class="co">#&gt; sig_prop 15617.8185</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rse</span></span>
<span><span class="co">#&gt;          V         KA         CL        d_V       d_KA       d_CL   sig_prop </span></span>
<span><span class="co">#&gt;  44.120338  51.256239   5.748842 207.941540 280.689945  53.350716  22.795275</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparison-of-designs">Comparison of designs<a class="anchor" aria-label="anchor" href="#comparison-of-designs"></a>
</h3>
<p>The precision on CL is similar with the alternative design but the
other parameters are less well estimated.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">design_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Design 1"</span><span class="op">=</span><span class="va">ds1</span><span class="op">$</span><span class="va">rse</span>,<span class="st">"Design 2"</span><span class="op">=</span><span class="va">ds2</span><span class="op">$</span><span class="va">rse</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Design.1</th>
<th align="right">Design.2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">V</td>
<td align="right">8</td>
<td align="right">44</td>
</tr>
<tr class="even">
<td align="left">KA</td>
<td align="right">10</td>
<td align="right">51</td>
</tr>
<tr class="odd">
<td align="left">CL</td>
<td align="right">4</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">d_V</td>
<td align="right">40</td>
<td align="right">208</td>
</tr>
<tr class="odd">
<td align="left">d_KA</td>
<td align="right">61</td>
<td align="right">281</td>
</tr>
<tr class="even">
<td align="left">d_CL</td>
<td align="right">28</td>
<td align="right">53</td>
</tr>
<tr class="odd">
<td align="left">sig_prop</td>
<td align="right">14</td>
<td align="right">23</td>
</tr>
</tbody>
</table>
<p>Comparing the objective function value (OFV), we see that the
alternative design (less samples per subject) has a smaller OFV
(=worse). We can compare the two OFVs using efficiency, which tells us
the proportion extra individuals that are needed in the alternative
design to have the same information content as the original design
(around 4 times more individuals than are currently in the design).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/efficiency.html">efficiency</a></span><span class="op">(</span><span class="va">ds2</span><span class="op">$</span><span class="va">ofv</span>,<span class="va">ds1</span><span class="op">$</span><span class="va">ofv</span>,<span class="va">poped.db</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3.965919</span></span>
<span><span class="co">#&gt; attr(,"description")</span></span>
<span><span class="co">#&gt; [1] "(exp(ofv_final) / exp(ofv_init))^(1/n_parameters)"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="design-optimization">Design optimization<a class="anchor" aria-label="anchor" href="#design-optimization"></a>
</h2>
<p>Now we can optimize the sample times of the original design by
maximizing the OFV<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Tip: to make the optimization run faster use the option
&lt;code&gt;parallel = TRUE&lt;/code&gt; in the &lt;code&gt;poped_optim&lt;/code&gt; command.&lt;/p&gt;"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poped_optim.html">poped_optim</a></span><span class="op">(</span><span class="va">poped.db</span>, opt_xt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===============================================================================</span></span>
<span><span class="co">#&gt; FINAL RESULTS</span></span>
<span><span class="co">#&gt; Optimized Sampling Schedule</span></span>
<span><span class="co">#&gt; Group 1: 0.4573     10     10    240  240.9</span></span>
<span><span class="co">#&gt; Group 2: 0.4573     10     10    240  240.9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; OFV = 40.5277</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Efficiency: </span></span>
<span><span class="co">#&gt;   ((exp(ofv_final) / exp(ofv_init))^(1/n_parameters)) = 1.1902</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Expected relative standard error</span></span>
<span><span class="co">#&gt; (%RSE, rounded to nearest integer):</span></span>
<span><span class="co">#&gt;    Parameter   Values   RSE_0   RSE</span></span>
<span><span class="co">#&gt;            V     72.8       8     6</span></span>
<span><span class="co">#&gt;           KA     0.25      10     8</span></span>
<span><span class="co">#&gt;           CL     3.75       4     4</span></span>
<span><span class="co">#&gt;          d_V     0.09      40    33</span></span>
<span><span class="co">#&gt;         d_KA     0.09      61    50</span></span>
<span><span class="co">#&gt;         d_CL   0.0625      28    26</span></span>
<span><span class="co">#&gt;     sig_prop     0.04      14    15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total running time: 16.797 seconds</span></span>
<span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">poped.db</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-poped_files/figure-html/simulate_optimal_design-1.png" width="700"></p>
<p>We see that there are four distinct sample times for this design.
This means that for this model, with these exact parameter values, that
the most information from the study to inform the parameter estimation
is with these sample times.</p>
<div class="section level3">
<h3 id="examine-efficiency-of-sampling-windows">Examine efficiency of sampling windows<a class="anchor" aria-label="anchor" href="#examine-efficiency-of-sampling-windows"></a>
</h3>
<p>Of course, this means that there are multiple samples at some of
these time points. We can explore a more practical design by looking at
the loss of efficiency if we spread out sample times in a uniform
distribution around these optimal points
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><mn>30</mn></mrow><annotation encoding="application/x-tex">\pm 30</annotation></semantics></math>
minutes).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_efficiency_of_windows.html">plot_efficiency_of_windows</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">poped.db</span>,xt_windows<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-poped_files/figure-html/simulate_efficiency_windows-1.png" width="576"></p>
<p>Here we see the efficiency
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>F</mi><mi>I</mi><msub><mi>M</mi><mrow><mi>o</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>d</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">|</mo><mi>F</mi><mi>I</mi><msub><mi>M</mi><mrow><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>a</mi><mi>l</mi></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mn>1</mn><mi>/</mi><mi>n</mi><mi>p</mi><mi>a</mi><mi>r</mi></mrow></msup><annotation encoding="application/x-tex">(|FIM_{optimized}|/|FIM_{initial}|)^{1/npar}</annotation></semantics></math>)
drops below 80% in some cases, which is mostly caused by an increase in
the parameter uncertainty of the BSV parameter on absorption (om_KA).
Smaller windows or different windowing on different samples might be
needed. To investigate see <code><a href="../reference/plot_efficiency_of_windows.html">?plot_efficiency_of_windows</a></code>.</p>
</div>
<div class="section level3">
<h3 id="optimize-over-a-discrete-design-space">Optimize over a discrete design space<a class="anchor" aria-label="anchor" href="#optimize-over-a-discrete-design-space"></a>
</h3>
<p>In the previous example we optimized over a continuous design space
(sample times could be optimized to be any value between a lower and an
upper limit). We could also limit the search to only “allowed” values,
for example, only samples taken on the hour are allowed.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poped.db.discrete</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.poped.database.html">create.poped.database</a></span><span class="op">(</span><span class="va">poped.db</span>,discrete_xt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">240</span><span class="op">:</span><span class="fl">248</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                                          </span>
<span><span class="va">output_discrete</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poped_optim.html">poped_optim</a></span><span class="op">(</span><span class="va">poped.db.discrete</span>, opt_xt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">output_discrete</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===============================================================================</span></span>
<span><span class="co">#&gt; FINAL RESULTS</span></span>
<span><span class="co">#&gt; Optimized Sampling Schedule</span></span>
<span><span class="co">#&gt; Group 1:      1     10     10    240    241</span></span>
<span><span class="co">#&gt; Group 2:      1     10     10    240    241</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; OFV = 40.3782</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Efficiency: </span></span>
<span><span class="co">#&gt;   ((exp(ofv_final) / exp(ofv_init))^(1/n_parameters)) = 1.165</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Expected relative standard error</span></span>
<span><span class="co">#&gt; (%RSE, rounded to nearest integer):</span></span>
<span><span class="co">#&gt;    Parameter   Values   RSE_0   RSE</span></span>
<span><span class="co">#&gt;            V     72.8       8     6</span></span>
<span><span class="co">#&gt;           KA     0.25      10     8</span></span>
<span><span class="co">#&gt;           CL     3.75       4     4</span></span>
<span><span class="co">#&gt;          d_V     0.09      40    32</span></span>
<span><span class="co">#&gt;         d_KA     0.09      61    53</span></span>
<span><span class="co">#&gt;         d_CL   0.0625      28    27</span></span>
<span><span class="co">#&gt;     sig_prop     0.04      14    15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total running time: 10.325 seconds</span></span>
<span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">output_discrete</span><span class="op">$</span><span class="va">poped.db</span>, model_num_points <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-poped_files/figure-html/simulate_discrete_optimization-1.png" width="700"></p>
<p>Here we see that the optimization ran somewhat quicker, but gave a
less efficient design.</p>
</div>
<div class="section level3">
<h3 id="optimize-other-design-variables">Optimize ‘Other’ design variables<a class="anchor" aria-label="anchor" href="#optimize-other-design-variables"></a>
</h3>
<p>One could also optimize over dose, to see if a different dose could
help in parameter estimation .</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_dose_opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poped_optim.html">poped_optim</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">poped.db</span>, opt_xt<span class="op">=</span><span class="cn">TRUE</span>, opt_a<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In this case the results are predictable … higher doses give
observations with somewhat lower absolute residual variability leading
to both groups at the highest allowed dose levels (200 mg in this
case).</p>
</div>
<div class="section level3">
<h3 id="cost-function-to-optimize-dose">Cost function to optimize dose<a class="anchor" aria-label="anchor" href="#cost-function-to-optimize-dose"></a>
</h3>
<p>Optimizing the dose of a study just to have better model parameter
estimates may be somewhat implausible. Instead, let’s use a cost
function to optimize dose based on some sort of target concentration …
perhaps typical population trough concentrations of 0.2 and 0.35 for the
two groups of patients at 240 hours.</p>
<p>First we define the criteria we use to optimize the doses, here a
least squares minimization.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crit_fcn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">poped.db</span>,<span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_prediction.html">model_prediction</a></span><span class="op">(</span><span class="va">poped.db</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">pred_df</span><span class="op">[</span><span class="va">pred_df</span><span class="op">[</span><span class="st">"Time"</span><span class="op">]</span><span class="op">==</span><span class="fl">240</span>,<span class="st">"PRED"</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.35</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">crit_fcn</span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">poped.db</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.01469712</span></span></code></pre></div>
<p>Now we minimize the cost function</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poped_optim.html">poped_optim</a></span><span class="op">(</span><span class="va">poped.db</span>, opt_a <span class="op">=</span> <span class="cn">TRUE</span>, opt_xt <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     ofv_fun<span class="op">=</span><span class="va">crit_fcn</span>, </span>
<span>                     maximize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">output_cost</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===============================================================================</span></span>
<span><span class="co">#&gt; FINAL RESULTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimized Covariates:</span></span>
<span><span class="co">#&gt; Group 1: 31.5672 : 24</span></span>
<span><span class="co">#&gt; Group 2: 55.2426 : 24</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; OFV = 6.09293e-15</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Efficiency: </span></span>
<span><span class="co">#&gt;   (ofv_final / ofv_init) = 4.1457e-13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Expected relative standard error</span></span>
<span><span class="co">#&gt; (%RSE, rounded to nearest integer):</span></span>
<span><span class="co">#&gt;    Parameter   Values   RSE_0   RSE</span></span>
<span><span class="co">#&gt;            V     72.8       8     8</span></span>
<span><span class="co">#&gt;           KA     0.25      10    10</span></span>
<span><span class="co">#&gt;           CL     3.75       4     4</span></span>
<span><span class="co">#&gt;          d_V     0.09      40    40</span></span>
<span><span class="co">#&gt;         d_KA     0.09      61    60</span></span>
<span><span class="co">#&gt;         d_CL   0.0625      28    28</span></span>
<span><span class="co">#&gt;     sig_prop     0.04      14    14</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total running time: 3.688 seconds</span></span></code></pre></div>
<p>We see that the optimal doses are 31.6 and 55.2 for the two groups.
This leads to population trough concentrations of 0.2 and 0.35 for the
two groups of patients at 240 hours:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span><span class="op">(</span><span class="va">output_cost</span><span class="op">$</span><span class="va">poped.db</span>, model_num_points <span class="op">=</span> <span class="fl">300</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">230</span>,<span class="fl">250</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-poped_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://katalog.uu.se/profile/?id=N4-631" class="external-link">Andrew C. Hooker</a>, Marco Foracchia, <a href="https://katalog.uu.se/profile/?id=N9-467" class="external-link">Sebastian Ueckert</a>, <a href="https://scholar.google.se/citations?user=4CgHwr0AAAAJ&amp;hl=en" class="external-link">Joakim Nyberg</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
